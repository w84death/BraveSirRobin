/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.prototype.toRad=function(){return(this/180)*Math.PI;};Number.prototype.toDeg=function(){return(this*180)/Math.PI;};Array.prototype.erase=function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)];};Function.prototype.bind=Function.prototype.bind||function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply((this instanceof fNOP&&oThis?this:oThis),aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};window.ig={game:null,debug:null,version:'1.23',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class||ext===null){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},setVendorAttribute:function(el,attr,val){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);el[attr]=el['ms'+uc]=el['moz'+uc]=el['webkit'+uc]=el['o'+uc]=val;},getVendorAttribute:function(el,attr){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);return el[attr]||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},normalizeVendorAttribute:function(el,attr){var prefixedVal=ig.getVendorAttribute(el,attr);if(!el[attr]&&prefixedVal){el[attr]=prefixedVal;}},getImagePixels:function(image,x,y,width,height){var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');ig.System.SCALE.CRISP(canvas,ctx);var ratio=ig.getVendorAttribute(ctx,'backingStorePixelRatio')||1;ig.normalizeVendorAttribute(ctx,'getImageDataHD');var realWidth=image.width/ratio,realHeight=image.height/ratio;canvas.width=Math.ceil(realWidth);canvas.height=Math.ceil(realHeight);ctx.drawImage(image,0,0,realWidth,realHeight);return(ratio===1)?ctx.getImageData(x,y,width,height):ctx.getImageDataHD(x,y,width,height);},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(){},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(var j=0;j<requires.length;j++){var m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw("Unresolved (or circular?) dependencies. "+"Most likely there's a name/path mismatch for one of the listed modules "+"or a previous syntax error prevents a module from loading:\n"+
unresolved.join('\n'));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.winPhone||/mobile/i.test(navigator.userAgent);ig.ua.touchDevice=(('ontouchstart'in window)||(window.navigator.msMaxTouchPoints));},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}}};ig.normalizeVendorAttribute(window,'requestAnimationFrame');if(window.requestAnimationFrame){var next=1,anims={};window.ig.setAnimation=function(callback,element){var current=next++;anims[current]=true;var animate=function(){if(!anims[current]){return;}
window.requestAnimationFrame(animate,element);callback();};window.requestAnimationFrame(animate,element);return current;};window.ig.clearAnimation=function(id){delete anims[id];};}
else{window.ig.setAnimation=function(callback,element){return window.setInterval(callback,1000/60);};window.ig.clearAnimation=function(id){window.clearInterval(id);};}
var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;var lastClassId=0;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;Class.classId=prototype.classId=++lastClassId;return Class;};if(window.ImpactMixin){ig.merge(ig,window.ImpactMixin);}})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path){this.path=path;this.load();},load:function(loadCallback){if(this.loaded){if(loadCallback){loadCallback(this.path,true);}
return;}
else if(!this.loaded&&ig.ready){this.loadCallback=loadCallback||null;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=ig.prefix+this.path+ig.nocache;}
else{ig.addResource(this);}
ig.Image.cache[this.path]=this;},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Date.now();},onload:function(event){this.width=this.data.width;this.height=this.data.height;this.loaded=true;if(ig.system.scale!=1){this.resize(ig.system.scale);}
if(this.loadCallback){this.loadCallback(this.path,true);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var origPixels=ig.getImagePixels(this.data,0,0,this.width,this.height);var widthScaled=this.width*scale;var heightScaled=this.height*scale;var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');var scaledPixels=scaledCtx.getImageData(0,0,widthScaled,heightScaled);for(var y=0;y<heightScaled;y++){for(var x=0;x<widthScaled;x++){var index=(Math.floor(y/scale)*this.width+Math.floor(x/scale))*4;var indexScaled=(y*widthScaled+x)*4;scaledPixels.data[indexScaled]=origPixels.data[index];scaledPixels.data[indexScaled+1]=origPixels.data[index+1];scaledPixels.data[indexScaled+2]=origPixels.data[index+2];scaledPixels.data[indexScaled+3]=origPixels.data[index+3];}}
scaledCtx.putImageData(scaledPixels,0,0);this.data=scaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width,height);ig.Image.drawCount++;},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=Math.floor(tileWidth*scale);var tileHeightScaled=Math.floor(tileHeight*scale);var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,(Math.floor(tile*tileWidth)%this.width)*scale,(Math.floor(tile*tileWidth/this.width)*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled,tileHeightScaled);if(flipX||flipY){ig.system.context.restore();}
ig.Image.drawCount++;}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},heightForString:function(text){return text.split('\n').length*(this.height+this.lineSpacing);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){ig.system.context.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){ig.system.context.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var px=ig.getImagePixels(image,0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]>127){currentWidth++;}
else if(px.data[index]<128&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio){ig.Sound.enabled=false;return;}
var probe=new Audio();for(var i=0;i<ig.Sound.use.length;i++){var format=ig.Sound.use[i];if(probe.canPlayType(format.mime)){this.format=format;break;}}
if(!this.format){ig.Sound.enabled=false;}},load:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[path]){if(multiChannel&&this.clips[path].length<ig.Sound.channels){for(var i=this.clips[path].length;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return this.clips[path][0];}
var clip=new Audio(realPath);if(loadCallback){clip.addEventListener('canplaythrough',function cb(ev){clip.removeEventListener('canplaythrough',cb,false);loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,false,ev);},false);}
clip.preload='auto';clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return clip;},get:function(path){var channels=this.clips[path];for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);if(Object.defineProperty){Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});}
else if(this.__defineGetter__){this.__defineGetter__('volume',this.getVolume.bind(this));this.__defineSetter__('volume',this.setVolume.bind(this));this.__defineGetter__('loop',this.getLooping.bind(this));this.__defineSetter__('loop',this.setLooping.bind(this));}},add:function(music,name){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);this.tracks.push(track);if(name){this.namedTracks[name]=track;}
if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();this.currentTrack.currentTime=0;},play:function(name){if(name&&this.namedTracks[name]){var newTrack=this.namedTracks[name];if(newTrack!=this.currentTrack){this.stop();this.currentTrack=newTrack;}}
else if(!this.currentTrack){return;}
this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){this.tracks[i].volume=this._volume;}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,init:function(path,multiChannel){this.path=path;this.multiChannel=(multiChannel!==false);this.load();},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled){return;}
this.currentClip=ig.soundManager.get(this.path);this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.play();},stop:function(){if(this.currentClip){this.currentClip.pause();this.currentClip.currentTime=0;}}});ig.Sound.FORMAT={MP3:{ext:'mp3',mime:'audio/mpeg'},M4A:{ext:'m4a',mime:'audio/mp4; codecs=mp4a'},OGG:{ext:'ogg',mime:'audio/ogg; codecs=vorbis'},WEBM:{ext:'webm',mime:'audio/webm; codecs=vorbis'},CAF:{ext:'caf',mime:'audio/x-caf'}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=true;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return(this.pausedAt?0:delta);},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){if(!this.pausedAt){this.pausedAt=ig.Timer.time;}},unpause:function(){if(this.pausedAt){this.base+=ig.Timer.time-this.pausedAt;this.pausedAt=0;}}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.resize(width,height,scale);this.context=this.canvas.getContext('2d');this.getDrawPos=ig.System.drawMode;if(this.scale!=1){ig.System.scaleMode=ig.System.SCALE.CRISP;}
ig.System.scaleMode(this.canvas,this.context);},resize:function(width,height,scale){this.width=width;this.height=height;this.scale=scale||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)=='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=true;},clear:function(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}},getDrawPos:null});ig.System.DRAW={AUTHENTIC:function(p){return Math.round(p)*this.scale;},SMOOTH:function(p){return Math.round(p*this.scale);},SUBPIXEL:function(p){return p*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',false);canvas.style.imageRendering='-moz-crisp-edges';canvas.style.imageRendering='-o-crisp-edges';canvas.style.imageRendering='-webkit-optimize-contrast';canvas.style.imageRendering='crisp-edges';canvas.style.msInterpolationMode='nearest-neighbor';},SMOOTH:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',true);canvas.style.imageRendering='';canvas.style.msInterpolationMode='';}};ig.System.scaleMode=ig.System.SCALE.SMOOTH;});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;var mouseWheelBound=this.mousewheel.bind(this);ig.system.canvas.addEventListener('mousewheel',mouseWheelBound,false);ig.system.canvas.addEventListener('DOMMouseScroll',mouseWheelBound,false);ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);ig.system.canvas.addEventListener('mousedown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('mouseup',this.keyup.bind(this),false);ig.system.canvas.addEventListener('mousemove',this.mousemove.bind(this),false);if(ig.ua.touchDevice){ig.system.canvas.addEventListener('touchstart',this.keydown.bind(this),false);ig.system.canvas.addEventListener('touchend',this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchmove',this.mousemove.bind(this),false);ig.system.canvas.addEventListener('MSPointerDown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('MSPointerUp',this.keyup.bind(this),false);ig.system.canvas.addEventListener('MSPointerMove',this.mousemove.bind(this),false);ig.system.canvas.style.msTouchAction='none';}},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},initAccelerometer:function(){if(this.isUsingAccelerometer){return;}
window.addEventListener('devicemotion',this.devicemotion.bind(this),false);},mousewheel:function(event){var delta=event.wheelDelta?event.wheelDelta:(event.detail*-1);var code=delta>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;this.presses[action]=true;this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},mousemove:function(event){var internalWidth=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;var scale=ig.system.scale*(internalWidth/ig.system.realWidth);var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
var ev=event.touches?event.touches[0]:event;this.mouse.x=(ev.clientX-pos.left)/scale;this.mouse.y=(ev.clientY-pos.top)/scale;},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='touchstart'||event.type=='mousedown'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;}
event.stopPropagation();event.preventDefault();}},keyup:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},devicemotion:function(event){this.accel=event.accelerationIncludingGravity;},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);element.addEventListener('MSPointerDown',function(ev){that.touchStart(ev,action);},false);element.addEventListener('MSPointerUp',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return!!this.delayedKeyup[action];},clearPressed:function(){for(var action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;}
this.delayedKeyup={};this.presses={};},touchStart:function(event,action){this.actions[action]=true;this.presses[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){"use strict";ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});

// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.image').defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(path,width,height){this.width=width;this.height=height;this.image=new ig.Image(path);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;this.tile=this.sequence[0];},rewind:function(){this.timer.set();this.loopCount=0;this.frame=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f-0.0001);this.update();},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var frameTotal=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(frameTotal/this.sequence.length);if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=this.last.x=x;this.pos.y=this.last.y=y;ig.merge(this,settings);},reset:function(x,y,settings){var proto=this.constructor.prototype;this.pos.x=x;this.pos.y=y;this.last.x=x;this.last.y=y;this.vel.x=proto.vel.x;this.vel.y=proto.vel.y;this.accel.x=proto.accel.x;this.accel.y=proto.accel.y;this.health=proto.health;this._killed=proto._killed;this.standing=proto.standing;this.type=proto.type;this.checkAgainst=proto.checkAgainst;this.collides=proto.collides;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;var res=ig.game.collisionMap.trace(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);this.handleMovementTrace(res);if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
if(res.collision.slope){var s=res.collision.slope;if(this.bounciness>0){var proj=this.vel.x*s.nx+this.vel.y*s.ny;this.vel.x=(this.vel.x-s.nx*proj*2)*this.bounciness;this.vel.y=(this.vel.y-s.ny*proj*2)*this.bounciness;}
else{var lengthSquared=s.x*s.x+s.y*s.y;var dot=(this.vel.x*s.x+this.vel.y*s.y)/lengthSquared;this.vel.x=s.x*dot;this.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>this.slopeStanding.min&&angle<this.slopeStanding.max){this.standing=true;}}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){},erase:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;this.pxWidth=this.width*this.tilesize;this.pxHeight=this.height*this.tilesize;},getTile:function(x,y){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}}});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(tilesize,data,tiledef){this.parent(tilesize,data);this.tiledef=tiledef||ig.CollisionMap.defaultTileDef;for(var t in this.tiledef){if(t|0>this.lastSlope){this.lastSlope=t|0;}}},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false,slope:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize);if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;vx=0;}
if(res.collision.y){sy=0;vy=0;}
if(res.collision.slope){break;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height,rvx,rvy,step){res.pos.x+=vx;res.pos.y+=vy;var t=0;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=Math.max(Math.floor(y/this.tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/this.tilesize),this.height);var tileX=Math.floor((res.pos.x+pxOffsetX)/this.tilesize);var prevTileX=Math.floor((x+pxOffsetX)/this.tilesize);if(step>0||tileX==prevTileX||prevTileX<0||prevTileX>=this.width){prevTileX=-1;}
if(tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){if(prevTileX!=-1){t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.x=true;res.tile.x=t;x=res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;rvx=0;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x/this.tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/this.tilesize),this.width);var tileY=Math.floor((res.pos.y+pxOffsetY)/this.tilesize);var prevTileY=Math.floor((y+pxOffsetY)/this.tilesize);if(step>0||tileY==prevTileY||prevTileY<0||prevTileY>=this.height){prevTileY=-1;}
if(tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){if(prevTileY!=-1){t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}},_checkTileDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY){var def=this.tiledef[t];if(!def){return false;}
var lx=(tileX+def[0])*this.tilesize,ly=(tileY+def[1])*this.tilesize,lvx=(def[2]-def[0])*this.tilesize,lvy=(def[3]-def[1])*this.tilesize,solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx,ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0){if(vx*-lvy+vy*lvx<0){return solid;}
var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy/length,ny=-lvx/length;var proj=tx*nx+ty*ny;var px=nx*proj,py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy){return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
return false;}});var H=1/2,N=1/3,M=2/3,SOLID=true,NON_SOLID=false;ig.CollisionMap.defaultTileDef={5:[0,1,1,M,SOLID],6:[0,M,1,N,SOLID],7:[0,N,1,0,SOLID],3:[0,1,1,H,SOLID],4:[0,H,1,0,SOLID],2:[0,1,1,0,SOLID],10:[H,1,1,0,SOLID],21:[0,1,H,0,SOLID],32:[M,1,1,0,SOLID],43:[N,1,M,0,SOLID],54:[0,1,N,0,SOLID],27:[0,0,1,N,SOLID],28:[0,N,1,M,SOLID],29:[0,M,1,1,SOLID],25:[0,0,1,H,SOLID],26:[0,H,1,1,SOLID],24:[0,0,1,1,SOLID],11:[0,0,H,1,SOLID],22:[H,0,1,1,SOLID],33:[0,0,N,1,SOLID],44:[N,0,M,1,SOLID],55:[M,0,1,1,SOLID],16:[1,N,0,0,SOLID],17:[1,M,0,N,SOLID],18:[1,1,0,M,SOLID],14:[1,H,0,0,SOLID],15:[1,1,0,H,SOLID],13:[1,1,0,0,SOLID],8:[H,1,0,0,SOLID],19:[1,1,H,0,SOLID],30:[N,1,0,0,SOLID],41:[M,1,N,0,SOLID],52:[1,1,M,0,SOLID],38:[1,M,0,1,SOLID],39:[1,N,0,M,SOLID],40:[1,0,0,N,SOLID],36:[1,H,0,1,SOLID],37:[1,0,0,H,SOLID],35:[1,0,0,1,SOLID],9:[1,0,H,1,SOLID],20:[H,0,0,1,SOLID],31:[1,0,M,1,SOLID],42:[M,0,N,1,SOLID],53:[N,0,0,1,SOLID],12:[0,0,1,0,NON_SOLID],23:[1,1,0,1,NON_SOLID],34:[1,0,1,1,NON_SOLID],45:[0,1,0,0,NON_SOLID]};ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',foreground:false,enabled:true,preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(totalWidth,totalHeight),this.chunkSize);var chunkCols=Math.ceil(totalWidth/this.chunkSize),chunkRows=Math.ceil(totalHeight/this.chunkSize);this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1,th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=Math.floor(cx*this.chunkSize/this.tilesize/ig.system.scale),ty=Math.floor(cy*this.chunkSize/this.tilesize/ig.system.scale);var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;chunk.retinaResolutionEnabled=false;var chunkContext=chunk.getContext('2d');ig.System.scaleMode(chunk,chunkContext);var screenContext=ig.system.context;ig.system.context=chunkContext;for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=screenContext;return chunk;},draw:function(){if(!this.tiles.loaded||!this.enabled){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var w=this.width*this.tilesize*ig.system.scale;dx=(dx%w+w)%w;var h=this.height*this.tilesize*ig.system.scale;dy=(dy%h+h)%h;}
var minChunkX=Math.max(Math.floor(dx/this.chunkSize),0),minChunkY=Math.max(Math.floor(dy/this.chunkSize),0),maxChunkX=Math.ceil((dx+ig.system.realWidth)/this.chunkSize),maxChunkY=Math.ceil((dy+ig.system.realHeight)/this.chunkSize),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);ig.Image.drawCount++;if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX+=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY+=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=(tileY%this.height+this.height)%this.height;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=(tileX%this.width+this.width)%this.width;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:false,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:false,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;newMap.foreground=!!ld.foreground;newMap.preRender=!!ld.preRender;newMap.name=ld.name;this.backgroundMaps.push(newMap);}}
for(var i=0;i<this.entities.length;i++){this.entities[i].ready();}},loadLevelDeferred:function(data){this._levelToLoad=data;},getMapByName:function(name){if(name=='collision'){return this.collisionMap;}
for(var i=0;i<this.backgroundMaps.length;i++){if(this.backgroundMaps[i].name==name){return this.backgroundMaps[i];}}
return null;},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(ent instanceof entityClass&&!ent._killed){a.push(ent);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=true;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},run:function(){this.update();this.draw();},update:function(){if(this._levelToLoad){this.loadLevel(this._levelToLoad);this._levelToLoad=null;}
this.updateEntities();this.checkEntities();for(var i=0;i<this._deferredKill.length;i++){this._deferredKill[i].erase();this.entities.erase(this._deferredKill[i]);}
this._deferredKill=[];if(this._doSortEntities||this.autoSort){this.sortEntities();this._doSortEntities=false;}
for(var tileset in this.backgroundAnims){var anims=this.backgroundAnims[tileset];for(var a in anims){anims[a].update();}}},updateEntities:function(){for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},draw:function(){if(this.clearColor){ig.system.clear(this.clearColor);}
this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var mapIndex;for(mapIndex=0;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];if(map.foreground){break;}
map.setScreenPos(this.screen.x,this.screen.y);map.draw();}
this.drawEntities();for(mapIndex;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];map.setScreenPos(this.screen.x,this.screen.y);map.draw();}},drawEntities:function(){for(var i=0;i<this.entities.length;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};for(var e=0;e<this.entities.length;e++){var entity=this.entities[e];if(entity.type==ig.Entity.TYPE.NONE&&entity.checkAgainst==ig.Entity.TYPE.NONE&&entity.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=Math.floor(entity.pos.x/this.cellSize),ymin=Math.floor(entity.pos.y/this.cellSize),xmax=Math.floor((entity.pos.x+entity.size.x)/this.cellSize)+1,ymax=Math.floor((entity.pos.y+entity.size.y)/this.cellSize)+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex;},POS_X:function(a,b){return(a.pos.x+a.size.x)-(b.pos.x+b.size.x);},POS_Y:function(a,b){return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}};});

// lib/plugins/gamepad.js
ig.baked=true;ig.module('plugins.gamepad').defines(function(){var getField=function(){try
{return navigator.webkitGamepads||navigator.mozGamepads||navigator.gamepads||navigator.webkitGetGamepads()||navigator.mozGetGamepads()||navigator.getGamepads();}
catch(e)
{return{};}};var Item=function(){this.leftStickX=0.0;this.leftStickY=0.0;this.rightStickX=0.0;this.rightStickY=0.0;this.faceButton0=0.0;this.faceButton1=0.0;this.faceButton2=0.0;this.faceButton3=0.0;this.leftShoulder0=0.0;this.rightShoulder0=0.0;this.leftShoulder1=0.0;this.rightShoulder1=0.0;this.select=0.0;this.start=0.0;this.leftStickButton=0.0;this.rightStickButton=0.0;this.dpadUp=0.0;this.dpadDown=0.0;this.dpadLeft=0.0;this.dpadRight=0.0;this.deadZoneLeftStick=0.25;this.deadZoneRightStick=0.25;this.deadZoneShoulder0=0.0;this.deadZoneShoulder1=0.0;this.images=Gamepad.ImageDataUrls_Unknown;this.name="Unknown";};var deepCopy=function(into,from){into.leftStickX=from.leftStickX;into.leftStickY=from.leftStickY;into.rightStickX=from.rightStickX;into.rightStickY=from.rightStickY;into.faceButton0=from.faceButton0;into.faceButton1=from.faceButton1;into.faceButton2=from.faceButton2;into.faceButton3=from.faceButton3;into.leftShoulder0=from.leftShoulder0;into.rightShoulder0=from.rightShoulder0;into.leftShoulder1=from.leftShoulder1;into.rightShoulder1=from.rightShoulder1;into.select=from.select;into.start=from.start;into.leftStickButton=from.leftStickButton;into.rightStickButton=from.rightStickButton;into.dpadUp=from.dpadUp;into.dpadDown=from.dpadDown;into.dpadLeft=from.dpadLeft;into.dpadRight=from.dpadRight;};var contains=function(lookIn,forWhat){return lookIn.indexOf(forWhat)!=-1;};var userAgent=navigator.userAgent;var isWindows=contains(userAgent,'Windows NT');var isMac=contains(userAgent,'Macintosh');var isLinux=contains(userAgent,'Linux');var isChrome=contains(userAgent,'Chrome/');var isFirefox=contains(userAgent,'Firefox/');var axisToButton=function(value){return(value+1.0)/2.0;}
if(isFirefox){navigator.mozGamepads=[];var mozConnectHandler=function(e){navigator.mozGamepads[e.gamepad.index]=e.gamepad;}
var mozDisconnectHandler=function(e){navigator.mozGamepads[e.gamepad.index]=undefined;}
window.addEventListener("MozGamepadConnected",mozConnectHandler);window.addEventListener("MozGamepadDisconnected",mozDisconnectHandler);}
var mapPad=function(raw,mapped){var len=active.length;for(var i=0;i<len;++i)
{var entry=active[i];if(typeof(entry)=="undefined")return;var ss1=entry[0];var ss2=entry[1];if(contains(raw.id,ss1)&&contains(raw.id,ss2)){var handler=entry[2];handler(raw,mapped);var deviceident=entry[3];mapped.name=deviceident+" Player "+(raw.index+1);return;}}
var entry=active[0];if(typeof(entry)=="undefined")return;var handler=entry[2];handler(raw,mapped);var deviceident=entry[3];mapped.name=deviceident+" Player "+(raw.index+1);};var mapIndividualPad=function(rawPads,i){var raw=rawPads[i];if(!raw){prevData[i]=undefined;curData[i]=undefined;return;}
if(curData[i]===undefined){prevData[i]=new Item();curData[i]=new Item();}
deepCopy(prevData[i],curData[i]);mapPad(raw,curData[i]);};var prevData=[];var curData=[];var Gamepad={};window.Gamepad=Gamepad;Gamepad.getPreviousStates=function(){return prevData;};Gamepad.mappings=Gamepad.mappings||{one:[],two:[],three:[],four:[],active:true};Gamepad.getStates=function(){var rawPads=getField()
var len=rawPads.length;for(var i=0;i<len;++i){mapIndividualPad(rawPads,i);}
for(;i<curData.length;++i){prevData[i]=undefined;curData[i]=undefined;}
return curData;};Gamepad.getPreviousState=function(i){return prevData[i];};Gamepad.getState=function(i){var rawPads=getField();mapIndividualPad(rawPads,i);return curData[i];};Gamepad.supported=getField()!=undefined;var ChromeWindowsXinputGamepad=function(raw,into,index){into.leftStickX=raw.axes[0];into.leftStickY=raw.axes[1];into.rightStickX=raw.axes[2];into.rightStickY=raw.axes[3];into.faceButton0=raw.buttons[0];into.faceButton1=raw.buttons[1];into.faceButton2=raw.buttons[2];into.faceButton3=raw.buttons[3];into.leftShoulder0=raw.buttons[4];into.rightShoulder0=raw.buttons[5];into.leftShoulder1=raw.buttons[6];into.rightShoulder1=raw.buttons[7];into.select=raw.buttons[8];into.start=raw.buttons[9];into.leftStickButton=raw.buttons[10];into.rightStickButton=raw.buttons[11];into.dpadUp=raw.buttons[12];into.dpadDown=raw.buttons[13];into.dpadLeft=raw.buttons[14];into.dpadRight=raw.buttons[15];into.deadZoneLeftStick=7849.0/32767.0;into.deadZoneRightStick=8689/32767.0;into.deadZoneShoulder0=0.5;into.deadZoneShoulder1=30.0/255.0;};var FirefoxWindowsXbox360Controller=function(raw,into,index){into.leftStickX=raw.axes[0];into.leftStickY=raw.axes[1];into.rightStickX=raw.axes[3];into.rightStickY=raw.axes[4];into.faceButton0=raw.buttons[0];into.faceButton1=raw.buttons[1];into.faceButton2=raw.buttons[2];into.faceButton3=raw.buttons[3];into.leftShoulder0=raw.buttons[4];into.rightShoulder0=raw.buttons[5];into.leftShoulder1=raw.axes[2]>0?raw.axes[2]:0;into.rightShoulder1=raw.axes[2]<0?-raw.axes[2]:0;into.select=raw.buttons[6];into.start=raw.buttons[7];into.leftStickButton=raw.buttons[8];into.rightStickButton=raw.buttons[9];into.dpadUp=raw.axes[6]<-0.5?1:0;into.dpadDown=raw.axes[6]>0.5?1:0;into.dpadLeft=raw.axes[5]<-0.5?1:0;into.dpadRight=raw.axes[5]>0.5?1:0;into.deadZoneLeftStick=7849.0/32767.0;into.deadZoneRightStick=8689/32767.0;into.deadZoneShoulder0=0.5;into.deadZoneShoulder1=30.0/255.0;}
var CommonMacXbox360Controller=function(raw,into,index){into.leftStickX=raw.axes[0];into.leftStickY=raw.axes[1];into.faceButton0=raw.buttons[0];into.faceButton1=raw.buttons[1];into.faceButton2=raw.buttons[2];into.faceButton3=raw.buttons[3];into.leftShoulder0=raw.buttons[4];into.rightShoulder0=raw.buttons[5];into.select=raw.buttons[9];into.start=raw.buttons[8];into.leftStickButton=raw.buttons[6];into.rightStickButton=raw.buttons[7];into.dpadUp=raw.buttons[11];into.dpadDown=raw.buttons[12];into.dpadLeft=raw.buttons[13];into.dpadRight=raw.buttons[14];into.deadZoneLeftStick=7849.0/32767.0;into.deadZoneRightStick=8689/32767.0;into.deadZoneShoulder0=0.5;into.deadZoneShoulder1=30.0/255.0;}
var ChromeMacXbox360Controller=function(raw,into,index){CommonMacXbox360Controller(raw,into,index);into.rightStickX=raw.axes[3];into.rightStickY=raw.axes[4];into.leftShoulder1=axisToButton(raw.axes[2]);into.rightShoulder1=axisToButton(raw.axes[5]);};var ChromeMacLogitechF310Controller=function(raw,into,index){into.leftStickX=raw.axes[0];into.leftStickY=raw.axes[1];into.faceButton0=raw.buttons[1];into.faceButton1=raw.buttons[2];into.faceButton2=raw.buttons[0];into.faceButton3=raw.buttons[3];into.leftShoulder0=raw.buttons[4];into.rightShoulder0=raw.buttons[5];into.select=raw.buttons[8];into.start=raw.buttons[9];into.leftStickButton=raw.buttons[10];into.rightStickButton=raw.buttons[11];into.dpadUp=0;into.dpadDown=0;into.dpadLeft=0;into.dpadRight=0;into.deadZoneLeftStick=7849.0/32767.0;into.deadZoneRightStick=8689/32767.0;into.deadZoneShoulder0=0.5;into.deadZoneShoulder1=30.0/255.0;console.log(raw.axes);into.rightStickX=raw.axes[2];into.rightStickY=raw.axes[5];into.leftShoulder1=raw.buttons[6];into.rightShoulder1=raw.buttons[7];};var FirefoxMacXbox360Controller=function(raw,into,index){CommonMacXbox360Controller(raw,into,index);into.rightStickX=raw.axes[2];into.rightStickY=raw.axes[3];into.leftShoulder1=axisToButton(raw.axes[4]);into.rightShoulder1=axisToButton(raw.axes[5]);};var CommonMacPS3Controller=function(Raw,into,index){into.leftStickX=raw.axes[0];into.leftStickY=raw.axes[1];into.rightStickX=raw.axes[2];into.faceButton0=raw.buttons[14];into.faceButton1=raw.buttons[13];into.faceButton2=raw.buttons[15];into.faceButton3=raw.buttons[12];into.leftShoulder0=raw.buttons[10];into.rightShoulder0=raw.buttons[11];into.leftShoulder1=raw.buttons[8];into.rightShoulder1=raw.buttons[9];into.select=raw.buttons[0];into.start=raw.buttons[3];into.leftStickButton=raw.buttons[1];into.rightStickButton=raw.buttons[2];into.dpadUp=raw.buttons[4];into.dpadDown=raw.buttons[6];into.dpadLeft=raw.buttons[7];into.dpadRight=raw.buttons[5];};var FirefoxMacPS3Controller=function(raw,into,index){CommonMacPS3Controller(raw,into,index);into.rightStickY=raw.axes[3];};var ChromeMacPS3Controller=function(raw,into,index){into.rightStickY=raw.axes[5];};var ChromeGenericController=function(raw,into,index){into.leftStickX=raw.axes[0];into.leftStickY=raw.axes[1];into.rightStickX=raw.axes[3];into.rightStickY=raw.axes[2];into.faceButton0=raw.buttons[0];into.faceButton1=raw.buttons[1];into.faceButton2=raw.buttons[2];into.faceButton3=raw.buttons[3];into.leftShoulder0=raw.buttons[4];into.rightShoulder0=raw.buttons[5];into.leftShoulder1=raw.buttons[7];into.rightShoulder1=raw.buttons[6];into.select=raw.buttons[8];into.start=raw.buttons[9];into.leftStickButton=raw.buttons[10];into.rightStickButton=raw.buttons[11];into.dpadUp=raw.axes[5]<-0.5?1:0;into.dpadDown=raw.axes[5]>0.5?1:0;into.dpadLeft=raw.axes[4]<-0.5?1:0;into.dpadRight=raw.axes[4]>0.5?1:0;into.deadZoneLeftStick=7849.0/32767.0;into.deadZoneRightStick=8689/32767.0;into.deadZoneShoulder0=0.5;into.deadZoneShoulder1=30.0/255.0;};var CommonLinuxXbox360Controller=function(raw,into,index){into.leftStickX=raw.axes[0];into.leftStickY=raw.axes[1];into.faceButton0=raw.buttons[0];into.faceButton1=raw.buttons[1];into.faceButton2=raw.buttons[2];into.faceButton3=raw.buttons[3];into.leftShoulder0=raw.buttons[4];into.rightShoulder0=raw.buttons[5];into.select=raw.buttons[8];into.start=raw.buttons[9];into.leftStickButton=raw.buttons[10];into.rightStickButton=raw.buttons[11];into.dpadUp=raw.buttons[12];into.dpadDown=raw.buttons[13];into.dpadLeft=raw.buttons[14];into.dpadRight=raw.buttons[15];into.deadZoneLeftStick=7849.0/32767.0;into.deadZoneRightStick=8689.0/32767.0;into.deadZoneShoulder0=0.5;into.deadZoneShoulder1=30.0/255.0;}
var ChromeLinuxXbox360Controller=function(raw,into,index){CommonLinuxXbox360Controller(raw,into,index);into.rightStickX=raw.axes[2];into.rightStickY=raw.axes[3];into.leftShoulder1=raw.buttons[6];into.rightShoulder1=raw.buttons[7];};var FirefoxLinuxXbox360Controller=function(raw,into,index){CommonLinuxXbox360Controller(raw,into,index);into.rightStickX=raw.axes[2];into.rightStickY=raw.axes[3];into.leftShoulder1=axisToButton(raw.axes[4]);into.rightShoulder1=axisToButton(raw.axes[5]);};var active=[];if(isChrome&&isWindows){active.push(['Vendor: Unknown','Product: Unknown',ChromeGenericController,"Generic Controller"]);active.push(['XInput ','GAMEPAD',ChromeWindowsXinputGamepad,"Xbox 360"]);}else if(isChrome&&isMac){active.push(['Vendor: Unknown','Product: Unknown',ChromeGenericController,"Generic Controller"]);active.push(['Vendor: 045e','Product: 028e',ChromeMacXbox360Controller,"Xbox 360"]);active.push(['Vendor: 045e','Product: 02a1',ChromeMacXbox360Controller,"Xbox 360"]);active.push(['Vendor: 054c','Product: 0268',ChromeMacPS3Controller,"Playstation 3"]);active.push(['Vendor: 046d','Product: c216',ChromeMacLogitechF310Controller,"Logitech F310"]);}else if(isFirefox&&isWindows){active.push(['Vendor: Unknown','Product: Unknown',ChromeGenericController,"Generic Controller"]);active.push(['45e-','28e-',FirefoxWindowsXbox360Controller,"Xbox 360"]);active.push(['45e-','2a1-',FirefoxWindowsXbox360Controller,"Xbox 360"]);active.push(['46d-','c21d-',FirefoxWindowsXbox360Controller,"Logitech F310"]);active.push(['46d-','c21e-',FirefoxWindowsXbox360Controller,"Logitech F510"]);}else if(isFirefox&&isMac){active.push(['Vendor: Unknown','Product: Unknown',ChromeGenericController,"Generic Controller"]);active.push(['45e-','28e-',FirefoxMacXbox360Controller,"Xbox 360"]);active.push(['54c-','268-',FirefoxMacPS3Controller,"Playstation 3"]);}else if(isChrome&&isLinux){console.log('Linux - Chrome');active.push(['Vendor: 045e','Product: 028e',ChromeLinuxXbox360Controller,"Xbox 360"]);}else if(isFirefox&&isLinux){console.log('Linux - Firefox');active.push(['45e-','28e-',FirefoxLinuxXbox360Controller,"Xbox 360"]);}
var activeButtonActions=[];var activeAxisActions=[];Gamepad.handleInput=function()
{if(Gamepad.mappings.active==false)return;var gamepads=Gamepad.getStates();for(var n=0;n<gamepads.length;n++)
{pad=gamepads[n];var mappings;switch(n)
{case 0:mappings=Gamepad.mappings.one;break;case 1:mappings=Gamepad.mappings.two;break;case 2:mappings=Gamepad.mappings.three;break;case 3:mappings=Gamepad.mappings.four;break;}
if(typeof(pad)=="undefined"||typeof(mappings)=="undefined")continue;for(m=0;m<mappings.length;m++)
{if(typeof(mappings[m][2])=="undefined")
{bindButtonToAction(pad[mappings[m][0]],mappings[m][1]);}}
for(m=0;m<mappings.length;m++)
{if(typeof(mappings[m][2])!="undefined")
{bindAxisToAction(pad[mappings[m][0]],mappings[m][1],mappings[m][2]);}}}}
bindButtonToAction=function(myButton,action)
{if(activeButtonActions[action]&&myButton==0&&!ig.input.pressed(action))
{if(!activeAxisActions[action])
{ig.input.delayedKeyup[action]=true;}
activeButtonActions[action]=false;}
else if(myButton==1)
{ig.input.actions[action]=true;if(!ig.input.locks[action])
{ig.input.presses[action]=true;ig.input.locks[action]=true;activeButtonActions[action]=true;}}}
bindAxisToAction=function(myAxis,negativeAction,positiveAction)
{if(activeAxisActions[negativeAction]&&myAxis>=-0.7&&!ig.input.pressed(negativeAction))
{if(!activeButtonActions[negativeAction])
{ig.input.delayedKeyup[negativeAction]=true;}
activeAxisActions[negativeAction]=false;}
else if(myAxis<-0.7)
{ig.input.actions[negativeAction]=true;if(!ig.input.locks[negativeAction])
{ig.input.presses[negativeAction]=true;ig.input.locks[negativeAction]=true;}
activeAxisActions[negativeAction]=true;}
if(activeAxisActions[positiveAction]&&myAxis<=0.7&&!ig.input.pressed(positiveAction))
{if(!activeButtonActions[positiveAction])
{ig.input.delayedKeyup[positiveAction]=true;}
activeAxisActions[positiveAction]=false;}
else if(myAxis>0.7)
{ig.input.actions[positiveAction]=true;if(!ig.input.locks[positiveAction])
{ig.input.presses[positiveAction]=true;ig.input.locks[positiveAction]=true;activeAxisActions[positiveAction]=true;}}}});

// lib/impact/entity-pool.js
ig.baked=true;ig.module('impact.entity-pool').requires('impact.game').defines(function(){"use strict";ig.EntityPool={pools:{},mixin:{staticInstantiate:function(x,y,settings){return ig.EntityPool.getFromPool(this.classId,x,y,settings);},erase:function(){ig.EntityPool.putInPool(this);}},enableFor:function(Class){Class.inject(this.mixin);},getFromPool:function(classId,x,y,settings){var pool=this.pools[classId];if(!pool||!pool.length){return null;}
var instance=pool.pop();instance.reset(x,y,settings);return instance;},putInPool:function(instance){if(!this.pools[instance.classId]){this.pools[instance.classId]=[instance];}
else{this.pools[instance.classId].push(instance);}},drainPool:function(classId){delete this.pools[classId];},drainAllPools:function(){this.pools={};}};ig.Game.inject({loadLevel:function(data){ig.EntityPool.drainAllPools();this.parent(data);}});});

// lib/game/entities/npc.js
ig.baked=true;ig.module('game.entities.npc').requires('impact.entity','impact.entity-pool').defines(function(){EntityNPC=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.BOTH,friction:{x:100,y:100},sHurt:new ig.Sound('media/sounds/attack.mp3',false),flip:false,movement:50,attackDamage:1,pushStrenght:12,attackSpeed:0.2,attackRange:24,defenceFactor:2,followRange:20,stuntTime:0.5,attackExplosion:false,score:10,idleTime:100,moveTime:50,simpleAI:{idle:0,up:0,down:0,left:0,right:0},destiny:{},swarmAttack:false,inteligence:7,poison:false,init:function(x,y,settings){this.parent(x,y,settings);this.timer=new ig.Timer();this.destiny=settings.destiny;this.collides=ig.Entity.COLLIDES.NEVER;if(settings.destiny){this.goToDestiny=true;}else{this.goToDestiny=false;}},reset:function(x,y,settings){this.parent(x,y,settings);this.timer.set(0);this.destiny=settings.destiny;if(settings.destiny){this.goToDestiny=true;}else{this.goToDestiny=false;}
this.collides=ig.Entity.COLLIDES.NEVER;},kill:function(){if(ig.game.getEntityByName('robin')){ig.game.score+=this.score;}
ig.game.spawnEntity(EntityGold,this.pos.x-16+((Math.random()*32)<<0),this.pos.y-16+((Math.random()*32)<<0),{gold:1});this.parent();},check:function(other){if(other instanceof EntityPlayer){if(this.timer.delta()>0){other.receiveDamage(this.attackDamage);ig.game.spawnEntity(EntityHit,other.pos.x-2,other.pos.y-4);this.timer.set(this.attackSpeed);}}
this.parent();},updateZindex:function(){if(this.vel.y!==0){this.zIndex=this.pos.y;ig.game.sortEntitiesDeferred();}},think:function(){var random=(Math.random()*200)<<0;if(this.simpleAI.up+this.simpleAI.right+this.simpleAI.down+this.simpleAI.left+this.simpleAI.idle<1){if(random<25){this.simpleAI.up+=(Math.random()*this.moveTime)<<0;}else
if(random<50){this.simpleAI.right+=(Math.random()*this.moveTime)<<0;}else
if(random<75){this.simpleAI.down+=(Math.random()*this.moveTime)<<0;}else
if(random<100){this.simpleAI.left+=(Math.random()*this.moveTime)<<0;}else{this.simpleAI.idle+=(Math.random()*this.idleTime)<<0;}}},pushOut:function(pos,pushStrength){if(pos){if(this.pos.x<pos.x){this.vel.x=-pushStrength;}
if(this.pos.x>=pos.x){this.vel.x=pushStrength;}
if(this.pos.y<pos.y){this.vel.y=-pushStrength;}
if(this.pos.y>=pos.y){this.vel.y=pushStrength;}}},receiveDamage:function(dmg,critical,pos,pushStrength){if(critical){dmg*=2;ig.game.spawnEntity(EntityMsg,this.pos.x,this.pos.y-6,{msg:dmg+'!'});this.pushOut(pos,pushStrength);this.parent(dmg);}else{if(Math.random()*10>this.defenceFactor){this.sHurt.play();ig.game.spawnEntity(EntityHit,this.pos.x-2,this.pos.y-4);ig.game.spawnEntity(EntityMsg,this.pos.x,this.pos.y-6,{msg:dmg});this.pushOut(pos,pushStrength);this.parent(dmg);}else{ig.game.spawnEntity(EntityMsg,this.pos.x,this.pos.y-6,{msg:'miss'});}}},update:function(){this.parent();this.updateZindex();if(ig.game.pause)return;var hero=ig.game.getEntityByName('robin'),grails=ig.game.getEntitiesByType(EntityGrail),target=null,distance={id:0,dist:999};if(grails.length>0){for(var i=0;i<grails.length;i++){if(this.distanceTo(grails[i])<distance.dist){distance.id=i;distance.dist=this.distanceTo(grails[i]);}};target=grails[distance.id];}
if(hero){if(hero.distanceTo(this)<this.followRange||this.swarmAttack){target=hero;}}
if(this.goToDestiny){if(this.pos.x<this.destiny.x){this.pos.x++;}else
if(this.pos.x>this.destiny.x){this.pos.x--;}else
if(this.pos.y<this.destiny.y){this.pos.y++;}else
if(this.pos.y>this.destiny.y){this.pos.y--;}
if((this.pos.x<<0)==this.destiny.x&&(this.pos.y<<0)==this.destiny.y){this.goToDestiny=false;this.collides=ig.Entity.COLLIDES.LITE;}}else{this.think();if(this.simpleAI.up>0)this.simpleAI.up-=1;if(this.simpleAI.right>0)this.simpleAI.right-=1;if(this.simpleAI.down>0)this.simpleAI.down-=1;if(this.simpleAI.left>0)this.simpleAI.left-=1;if(this.simpleAI.idle>0)this.simpleAI.idle-=1;if(!this.attack){if(target){if((Math.random()*10)<<0>this.inteligence){if(this.pos.x>target.pos.x+4||this.pos.x<target.pos.x-4){if(this.pos.x>target.pos.x){this.vel.x=-this.movement;this.flip=false;}
if(this.pos.x<target.pos.x){this.vel.x=this.movement;this.flip=true;}}
if(this.pos.y>target.pos.y+4||this.pos.y<target.pos.y-4){if(this.pos.y>target.pos.y){this.vel.y=-this.movement;}
if(this.pos.y<target.pos.y){this.vel.y=this.movement;}}}else{if(this.simpleAI.left>0){this.vel.x=-this.movement;this.flip=false;}
if(this.simpleAI.right>0){this.vel.x=this.movement;this.flip=true;}
if(this.simpleAI.up>0){this.vel.y=-this.movement;}
if(this.simpleAI.down>0){this.vel.y=this.movement;}}
if(this.vel.x>0)this.vel.x-=1;if(this.vel.x<0)this.vel.x+=1;if(this.vel.y>0)this.vel.y-=1;if(this.vel.y<0)this.vel.y+=1;}}else{if(this.vel.x>0)this.vel.x-=1;if(this.vel.x<0)this.vel.x+=1;if(this.vel.y>0)this.vel.y-=1;if(this.vel.y<0)this.vel.y+=1;}
if(target){if(target.distanceTo(this)<this.attackRange){this.attack=true;this.currentAnim=this.anims['attack'];if(this.timer.delta()>0){this.timer.set(this.attackSpeed);}else
if(this.timer.delta().toFixed(1)>-0.01){this.currentAnim.rewind();target.receiveDamage(this.attackDamage,this.poison,{x:this.pos.x,y:this.pos.y},this.pushStrenght);if(this.attackExplosion){ig.game.spawnEntity(EntityExplosion,target.pos.x+(16-((Math.random()*32)<<0)),target.pos.y+(16-((Math.random()*32)<<0)));}
this.timer.set(this.attackSpeed);if(this.niCloud)ig.game.spawnEntity(EntityNiCloud,this.pos.x-2,this.pos.y-28);}}}}
if(this.vel.x!==0||this.vel.y!==0){this.currentAnim=this.anims['move'];}else
if(this.attack){if(this.currentAnim.loopCount>0){this.attack=false;}else{this.currentAnim=this.anims['attack'];}}else{this.currentAnim=this.anims['idle'];}
this.currentAnim.flip.x=this.flip;if(!this.flip){this.offset.x=5;}else{this.offset.x=2;}},});ig.EntityPool.enableFor(EntityNPC);});

// lib/game/entities/bat.js
ig.baked=true;ig.module('game.entities.bat').requires('game.entities.npc').defines(function(){EntityBat=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/bat.png',7,9),size:{x:4,y:3},offset:{x:1,y:6},health:2,idleTime:5,moveTime:30,attackDamage:1,attackSpeed:1.5,attackRange:14,stuntTime:0.5,score:5,movement:25,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.2,[0,1,2,3]);this.addAnim('move',0.2,[0,1,2,3]);this.addAnim('attack',0.2,[0,1,2,3]);},reset:function(x,y,settings){this.parent(x,y,settings);},update:function(){this.parent();},});});

// lib/game/entities/spider.js
ig.baked=true;ig.module('game.entities.spider').requires('game.entities.npc').defines(function(){EntitySpider=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/spider.png',16,16),size:{x:13,y:4},offset:{x:2,y:12},flip:false,attackRange:10,attackDamage:1,attackSpeed:1,followRange:25,stuntTime:0.8,health:4,movement:30,idleTime:40,moveTime:45,score:100,poison:3,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.5,[8,8,9]);this.addAnim('attack',0.1,[5,6,7]);this.addAnim('move',0.1,[1,2,3,4]);},update:function(){this.parent();}});});

// lib/game/levels/menu.js
ig.baked=true;ig.module('game.levels.menu').requires('impact.image','game.entities.bat','game.entities.spider').defines(function(){LevelMenu={"entities":[{"type":"EntityBat","x":225,"y":38,"settings":{"goToDestiny":"false"}},{"type":"EntityBat","x":89,"y":30,"settings":{"goToDestiny":"false"}},{"type":"EntitySpider","x":238,"y":8}],"layer":[{"name":"map","width":20,"height":15,"linkWithCollision":false,"visible":1,"tilesetName":"media/map.png","repeat":false,"preRender":true,"distance":"1","tilesize":16,"foreground":false,"data":[[0,0,0,65,67,67,67,67,67,67,67,67,67,67,67,67,68,0,0,0],[0,0,0,81,82,69,69,69,69,69,69,69,69,69,69,83,100,0,0,0],[0,0,0,81,69,69,69,69,69,69,69,69,69,69,69,69,100,0,0,0],[0,0,0,113,114,114,114,114,114,114,114,114,114,114,114,115,116,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}]};LevelMenuResources=[new ig.Image('media/map.png')];});

// lib/game/levels/menuhd.js
ig.baked=true;ig.module('game.levels.menuhd').requires('impact.image').defines(function(){LevelMenuhd={"entities":[],"layer":[{"name":"bg","width":20,"height":12,"linkWithCollision":false,"visible":true,"tilesetName":"media/map.png","repeat":false,"preRender":true,"distance":"1","tilesize":16,"foreground":false,"data":[[65,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,68],[81,82,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,83,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,84],[81,98,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,99,84],[113,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,116]]}]};LevelMenuhdResources=[new ig.Image('media/map.png')];});

// lib/game/levels/intro.js
ig.baked=true;ig.module('game.levels.intro').requires('impact.image').defines(function(){LevelIntro={"entities":[],"layer":[{"name":"map","width":20,"height":15,"linkWithCollision":false,"visible":1,"tilesetName":"media/map.png","repeat":false,"preRender":true,"distance":"1","tilesize":16,"foreground":false,"data":[[65,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,67,68],[81,82,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,83,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,100],[81,98,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,69,99,100],[113,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,114,116]]}]};LevelIntroResources=[new ig.Image('media/map.png')];});

// lib/game/entities/player.js
ig.baked=true;ig.module('game.entities.player').requires('impact.entity').defines(function(){EntityPlayer=ig.Entity.extend({animSheet:new ig.AnimationSheet('media/hero.png',12,12),size:{x:5,y:3},offset:{x:5,y:8},flip:false,type:ig.Entity.TYPE.A,checkAgainst:ig.Entity.TYPE.B,collides:ig.Entity.COLLIDES.ACTIVE,friction:{x:100,y:100},speed:50,sHurt:new ig.Sound('media/sounds/hurt.mp3',false),sLevelUp:new ig.Sound('media/sounds/level_up.mp3',false),sLose:new ig.Sound('media/sounds/lose.mp3',false),name:'robin',gold:0,health:3,maxHealth:3,attackRange:12,pushStrength:80,pushArea:16,poisonTimer:new ig.Timer(),timer:new ig.Timer(),defenceTimer:new ig.Timer(),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[7]);this.addAnim('block',1,[8]);this.addAnim('attack',0.1,[4,5,6]);this.addAnim('move',0.1,[0,1,2,3]);this.maxHealth=ig.game.stats.health;this.health=this.maxHealth;},reset:function(x,y,settings){this.parent(x,y,settings);this.maxHealth=ig.game.stats.health;this.health=this.maxHealth;},updateZindex:function(){if(this.vel.y!==0){this.zIndex=this.pos.y;ig.game.sortEntitiesDeferred();}},kill:function(){this.sLose.play();for(var i=0;i<this.gold;i++){ig.game.spawnEntity(EntityGold,this.pos.x-16+((Math.random()*32)<<0),this.pos.y-16+((Math.random()*32)<<0),{gold:1});}
ig.game.respawnTimer.set(ig.game.respawnTime);this.parent();},pushOut:function(pos,pushStrength){if(pos){if(this.pos.x<pos.x){this.vel.x=-pushStrength;}
if(this.pos.x>=pos.x){this.vel.x=pushStrength;}
if(this.pos.y<pos.y){this.vel.y=-pushStrength;}
if(this.pos.y>=pos.y){this.vel.y=pushStrength;}}},receiveDamage:function(dmg,poison,pos,pushStrength){if(Math.random()*10>ig.game.defence.missFactor||(ig.game.defence.timer.delta()<0&&this.pos.x!==0&&this.pos.y!==0)){this.pushOut(pos,pushStrength);if(poison){this.poisonTimer.set(poison);}
this.sHurt.play();ig.game.spawnEntity(EntityHit,this.pos.x-2,this.pos.y-4);if(!poison){ig.game.spawnEntity(EntityMsg,this.pos.x,this.pos.y-6,{msg:dmg});this.parent(dmg);}}else{ig.game.spawnEntity(EntityMsg,this.pos.x,this.pos.y-6,{msg:'miss'});}},update:function(){this.parent();this.updateZindex();if(!ig.input.state('defence')){if(ig.input.state('left')){this.vel.x=-this.speed;this.flip=false;}else
if(ig.input.state('right')){this.vel.x=this.speed;this.flip=true;}
if(ig.input.state('up')){this.vel.y=-this.speed;}else
if(ig.input.state('down')){this.vel.y=this.speed;}}
if(this.vel.x>0)this.vel.x-=1;if(this.vel.x<0)this.vel.x+=1;if(this.vel.y>0)this.vel.y-=1;if(this.vel.y<0)this.vel.y+=1;if(ig.input.pressed('attack')){this.vel.x=0;this.vel.y=0;this.currentAnim=this.anims['attack'];if(this.currentAnim.loopCount>0){this.currentAnim.rewind();}
for(var i=0;i<ig.game.entities.length;i++){if(ig.game.entities[i]instanceof EntityNPC){if(ig.game.entities[i].distanceTo(this)<this.attackRange){var p=100-ig.game.swords[ig.game.activeSword].chargePercentage;if(p>20){var critical=false;if(p>80){if((Math.random()*100)<<0<=(10+(2*ig.game.stats.attack))){critical=true;}}
var damage=(Math.random()*ig.game.swords[ig.game.activeSword].attack.max+ig.game.stats.attack)<<0;damage=damage<ig.game.swords[ig.game.activeSword].attack.min?ig.game.swords[ig.game.activeSword].attack.min:damage;if(p<100){damage*=p*0.01;damage=damage<<0;}
ig.game.entities[i].receiveDamage(damage,critical,{x:this.pos.x,y:this.pos.y},this.pushStrength);if(ig.game.swords[ig.game.activeSword].fire){ig.game.spawnEntity(EntityExplosion,ig.game.entities[i].pos.x+(16-((Math.random()*32)<<0)),ig.game.entities[i].pos.y+(16-((Math.random()*32)<<0)));}}
ig.game.swords[ig.game.activeSword].timer.set(ig.game.swords[ig.game.activeSword].charge);return;}}}
ig.game.swords[ig.game.activeSword].timer.set(ig.game.swords[ig.game.activeSword].charge);}
if(ig.input.pressed('defence')&&ig.game.defence.timer.delta()>0){ig.game.spawnEntity(EntityBlock,this.pos.x-12,this.pos.y-5);ig.game.defence.timer.set((ig.game.defence.charge+(ig.game.stats.defence*0.5)).toFixed(1));ig.game.defence.protectionTimer.set((ig.game.stats.defence*0.5).toFixed(1));for(var i=0;i<ig.game.entities.length;i++){if(ig.game.entities[i]instanceof EntityNPC){if(ig.game.entities[i].distanceTo(this)<this.pushArea+ig.game.stats.defence){ig.game.entities[i].pushOut(this.pos,this.pushStrength);}}}}
if(ig.input.pressed('action')&&ig.game.potions.quantity>0){if(this.health<this.maxHealth){this.health+=1;}
ig.game.spawnEntity(EntityMsg,this.pos.x,this.pos.y-6,{msg:'+1 hearth',blue:true});ig.game.potions.quantity-=1;}
if(this.poisonTimer.delta()<0){if(this.timer.delta()>0){this.health-=1;if(this.health<0)this.kill();this.sHurt.play();ig.game.spawnEntity(EntityMsg,this.pos.x,this.pos.y-6,{msg:1,green:true});this.timer.set(1);}}
if(ig.game.swords[ig.game.activeSword].timer.delta()<0){if(this.currentAnim.loopCount>0){if(this.vel.x!==0||this.vel.y!==0){this.currentAnim=this.anims['move'];}else{this.currentAnim=this.anims['idle'];}}}else
if(this.vel.x!==0||this.vel.y!==0){this.currentAnim=this.anims['move'];}else{if(ig.game.defence.timer.delta()<0){this.currentAnim=this.anims['block'];}else{this.currentAnim=this.anims['idle'];}}
this.currentAnim.flip.x=this.flip;if(!this.flip){this.offset.x=5;}else{this.offset.x=2;}},});});

// lib/game/entities/black_knight.js
ig.baked=true;ig.module('game.entities.black_knight').requires('game.entities.npc').defines(function(){EntityBlackKnight=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/black_knight.png',12,12),size:{x:5,y:3},offset:{x:5,y:8},flip:false,attackRange:12,health:6,idleTime:30,moveTime:45,score:30,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[7]);this.addAnim('attack',0.1,[4,5,6]);this.addAnim('move',0.1,[0,1,2,3]);this.addAnim('noarms_idle',0.2,[15]);this.addAnim('noarms_move',0.2,[8,9,10,11]);this.addAnim('nolegs_idle',0.2,[23]);this.addAnim('nolegs_move',0.2,[16,17,18,19]);this.attackDamage=3;this.attackSpeed=0.8;this.movement=20;this.pre='';},reset:function(x,y,settings){this.parent(x,y,settings);this.attackDamage=3;this.attackSpeed=0.8;this.movement=20;this.pre='';},update:function(){this.parent();if(this.health<4){this.attackDamage=1;this.pre='noarms';}
if(this.health<2){this.attackDamage=0;this.movement=10;this.pre='nolegs';}
if(this.pre!==''){if(this.vel.x!==0||this.vel.y!==0){this.currentAnim=this.anims[this.pre+'_move'];}else
if(this.attack){this.currentAnim=this.anims[this.pre+'_idle'];}else{this.currentAnim=this.anims[this.pre+'_idle'];}}},});});

// lib/game/entities/bridge_keeper.js
ig.baked=true;ig.module('game.entities.bridge_keeper').requires('game.entities.npc').defines(function(){EntityBridgeKeeper=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/bridge_keeper.png',12,12),size:{x:5,y:3},offset:{x:5,y:8},flip:false,attackRange:20,attackDamage:0,attackSpeed:1,stuntTime:0.5,movement:15,health:8,idleTime:50,moveTime:5,score:75,attackExplosion:true,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[7]);this.addAnim('attack',0.5,[4,5,6]);this.addAnim('move',0.1,[0,1,2,3]);},});});

// lib/game/entities/ni.js
ig.baked=true;ig.module('game.entities.ni').requires('game.entities.npc').defines(function(){EntityNi=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/ni.png',10,22),size:{x:6,y:3},offset:{x:2,y:19},flip:false,health:10,idleTime:10,moveTime:25,attackDamage:5,attackSpeed:1.5,attackRange:12,stuntTime:1,score:100,movement:15,niCloud:true,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[7]);this.addAnim('attack',0.5,[4,5,6,5,4]);this.addAnim('move',0.2,[0,1,2,3]);},reset:function(x,y,settings){this.parent(x,y,settings);},update:function(){this.parent();if(!this.flip){this.offset.x=2;}else{this.offset.x=2;}},});});

// lib/game/entities/particle.js
ig.baked=true;ig.module('game.entities.particle').requires('impact.entity','impact.entity-pool').defines(function(){EntityParticle=ig.Entity.extend({size:{x:1,y:1},offset:{x:0,y:0},type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,collides:ig.Entity.COLLIDES.NEVER,friction:{x:0,y:0},lifetime:1,fadetime:999,playOnce:false,alpha:1,init:function(x,y,settings){this.parent(x,y,settings);this.timer=new ig.Timer();},reset:function(x,y,settings){this.parent(x,y,settings);this.alpha=1;this.timer.set(0);if(this.anims.length>0){this.currentAnim=this.anims['idle'];this.currentAnim.rewind();}},update:function(){this.parent();if(this.playOnce){this.alpha=1;if(this.currentAnim.loopCount>0){this.kill();return;}}else{this.alpha=this.timer.delta().map(this.lifetime-this.fadetime,this.lifetime,1,0);if(this.timer.delta()>this.lifetime){this.kill();return;}}}});ig.EntityPool.enableFor(EntityParticle);});

// lib/game/entities/ni_cloud.js
ig.baked=true;ig.module('game.entities.ni_cloud').requires('game.entities.particle').defines(function(){EntityNiCloud=EntityParticle.extend({animSheet:new ig.AnimationSheet('media/ni_cloud.png',10,10),size:{x:10,y:10},offset:{x:0,y:0},lifetime:0.2,zIndex:9999,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',1,[0]);},});});

// lib/game/entities/rabbit.js
ig.baked=true;ig.module('game.entities.rabbit').requires('game.entities.npc').defines(function(){EntityRabbit=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/rabbit.png',12,12),size:{x:5,y:3},offset:{x:5,y:8},flip:false,attackRange:10,attackDamage:6,attackSpeed:1,stuntTime:1,health:10,idleTime:80,moveTime:45,score:100,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.5,[7,8,7,7,7,8,7,9]);this.addAnim('attack',0.1,[4,5,6]);this.addAnim('move',0.1,[0,1,2,3]);},});});

// lib/game/entities/spider_junior.js
ig.baked=true;ig.module('game.entities.spider_junior').requires('game.entities.npc').defines(function(){EntitySpiderJunior=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/spider_junior.png',12,12),size:{x:5,y:3},offset:{x:5,y:8},flip:false,attackRange:10,attackDamage:1,attackSpeed:0.6,followRange:25,stuntTime:0.4,health:1,movement:28,idleTime:10,moveTime:45,score:5,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.5,[7,7,3]);this.addAnim('attack',0.1,[4,5,6]);this.addAnim('move',0.1,[0,1,2]);},});});

// lib/game/entities/bee.js
ig.baked=true;ig.module('game.entities.bee').requires('game.entities.npc').defines(function(){EntityBee=EntityNPC.extend({animSheet:new ig.AnimationSheet('media/bee.png',12,18),size:{x:8,y:4},offset:{x:2,y:14},health:2,idleTime:5,moveTime:30,attackDamage:1,attackSpeed:1.5,attackRange:14,followRange:40,stuntTime:0.5,score:5,movement:25,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[0,1,0,1,0,1,2,3,2,3,2,3]);this.addAnim('move',0.1,[0,1,0,1,0,1,2,3,2,3,2,3]);this.addAnim('attack',0.1,[4,5,4,5,6,7,6,7]);},reset:function(x,y,settings){this.parent(x,y,settings);},update:function(){this.parent();},});});

// lib/game/entities/gate.js
ig.baked=true;ig.module('game.entities.gate').requires('impact.entity').defines(function(){EntityGate=ig.Entity.extend({size:{x:16,y:16},position:'top',spriteType:'top',state:'closed',bats:0,blackKnight:0,spawnEnemies:1,toSpawn:0,spawnIndex:0,spawnPointRate:1,spawnPoint:{},init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('top_closed',1,[1]);this.addAnim('top_opening',0.5,[1,2,3,4,5]);this.addAnim('top_open',1,[0]);this.addAnim('top_closing',0.5,[5,4,3,2,1]);this.addAnim('side_closed',1,[7]);this.addAnim('side_opening',0.5,[7,8,9,10,11]);this.addAnim('side_open',1,[6]);this.addAnim('side_closing',0.5,[11,10,9,8,7]);this.timer=new ig.Timer();this.position=settings.position;if(this.position=='bottom')this.spriteType='top';if(this.position=='left'||this.position=='right')this.spriteType='side';this.currentAnim=this.anims[this.spriteType+'_'+this.state];if(this.position=='top'){this.spawnPoint={x:this.pos.x+8,y:this.pos.y+36};this.center={x:this.pos.x+8,y:this.pos.y+12};}
if(this.position=='bottom'){this.spawnPoint={x:this.pos.x+8,y:this.pos.y-20};this.center={x:this.pos.x+8,y:this.pos.y+4};}
if(this.position=='right'){this.spawnPoint={x:this.pos.x-20,y:this.pos.y+8};this.center={x:this.pos.x+4,y:this.pos.y+8};}
if(this.position=='left'){this.spawnPoint={x:this.pos.x+36,y:this.pos.y+8};this.center={x:this.pos.x+12,y:this.pos.y+8};}
this.flipSprites();},flipSprites:function(){if(this.position=='bottom'){this.currentAnim.flip.y=true;}
if(this.position=='right'){this.currentAnim.flip.x=true;}},open:function(){if(this.state=='closed'){this.toSpawn=ig.game.quest.levels[ig.game.quest.currentLevel].waves[ig.game.wave].entities.length;this.state='opening';this.currentAnim=this.anims[this.spriteType+'_'+this.state];this.currentAnim.rewind();}},close:function(){if(this.state=='open'){this.state='closing';this.currentAnim=this.anims[this.spriteType+'_'+this.state];this.currentAnim.rewind();}},spawnEnemy:function(){if(this.spawnIndex<this.toSpawn){ig.game.spawnEntity(ig.game.quest.levels[ig.game.quest.currentLevel].waves[ig.game.wave].entities[this.spawnIndex++],this.center.x,this.center.y,{destiny:{x:this.spawnPoint.x,y:this.spawnPoint.y}});}else{this.toSpawn=0;this.spawnIndex=0;}},update:function(){this.parent();if(ig.game.wave<ig.game.quest.levels[ig.game.quest.currentLevel].waves.length){if(this.state=='opening'&&this.currentAnim.loopCount>0){this.state='open';}
if(this.state=='closing'&&this.currentAnim.loopCount>0){this.state='closed';}
this.currentAnim=this.anims[this.spriteType+'_'+this.state];this.flipSprites();if(this.state=='open'){if(this.toSpawn>0){if(this.timer.delta()>0){this.spawnEnemy();this.timer.set(this.spawnPointRate);}}else{this.close();}}}}});});

// lib/game/entities/gate_orange.js
ig.baked=true;ig.module('game.entities.gate_orange').requires('game.entities.gate').defines(function(){EntityGateOrange=EntityGate.extend({animSheet:new ig.AnimationSheet('media/maps/gate_orange.png',16,16),init:function(x,y,settings){this.parent(x,y,settings);}});});

// lib/game/entities/gate_green.js
ig.baked=true;ig.module('game.entities.gate_green').requires('game.entities.gate').defines(function(){EntityGateGreen=EntityGate.extend({animSheet:new ig.AnimationSheet('media/maps/gate_green.png',16,16),init:function(x,y,settings){this.parent(x,y,settings);}});});

// lib/game/entities/gate_red.js
ig.baked=true;ig.module('game.entities.gate_red').requires('game.entities.gate').defines(function(){EntityGateRed=EntityGate.extend({animSheet:new ig.AnimationSheet('media/maps/gate_red.png',16,16),init:function(x,y,settings){this.parent(x,y,settings);}});});

// lib/game/entities/gate_blue.js
ig.baked=true;ig.module('game.entities.gate_blue').requires('game.entities.gate').defines(function(){EntityGateBlue=EntityGate.extend({animSheet:new ig.AnimationSheet('media/maps/gate_blue.png',16,16),init:function(x,y,settings){this.parent(x,y,settings);}});});

// lib/game/entities/grail.js
ig.baked=true;ig.module('game.entities.grail').requires('impact.entity','impact.entity-pool').defines(function(){EntityGrail=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.FIXED,animSheet:new ig.AnimationSheet('media/grail.png',7,10),size:{x:7,y:3},offset:{x:0,y:6},health:10,killScore:10,name:'grail',init:function(x,y,settings){this.parent(x,y,settings);this.zIndex=this.pos.y;this.addAnim('idle',1,[0]);this.zIndex=this.pos.y;},reset:function(x,y,settings){this.parent(x,y,settings);this.zIndex=this.pos.y;},kill:function(){ig.game.score-=this.killScore;this.parent();},receiveDamage:function(){dmg=1;ig.game.spawnEntity(EntityHit,this.pos.x-2,this.pos.y-4);ig.game.spawnEntity(EntityMsg,this.pos.x+2,this.pos.y-6,{msg:this.health+' left',red:true});this.parent(dmg);},});ig.EntityPool.enableFor(EntityGrail);});

// lib/game/entities/chest.js
ig.baked=true;ig.module('game.entities.chest').requires('impact.entity').defines(function(){EntityChest=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.FIXED,animSheet:new ig.AnimationSheet('media/chest.png',14,10),size:{x:14,y:3},offset:{x:1,y:7},name:'chest',init:function(x,y,settings){this.parent(x,y,settings);this.zIndex=this.pos.y;this.addAnim('closed',1,[0]);this.addAnim('open',1,[1]);this.currentAnim=this.anims['closed'];},update:function(){this.parent();var robin=ig.game.getEntityByName('robin');if(robin){if(this.distanceTo(robin)<10){this.currentAnim=this.anims['open'];if(ig.input.pressed('action')){if(robin.gold>0){ig.game.spawnEntity(EntityPotion,this.pos.x+(24-((Math.random()*48)<<0)),this.pos.y+(24-((Math.random()*48)<<0)));robin.gold--;ig.game.spawnEntity(EntityMsg,this.pos.x+4,this.pos.y-12,{msg:'+POTION',blue:true});}else{ig.game.spawnEntity(EntityMsg,this.pos.x+4,this.pos.y-12,{msg:'NO GOLD',blue:true});}}}else{this.currentAnim=this.anims['closed'];}}}});});

// lib/game/entities/collectable.js
ig.baked=true;ig.module('game.entities.collectable').requires('impact.entity','impact.entity-pool').defines(function(){EntityCollectable=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.BOTH,collides:ig.Entity.COLLIDES.ACTIVE,init:function(x,y,settings){this.parent(x,y,settings);this.zIndex=this.pos.y;},reset:function(x,y,settings){this.parent(x,y,settings);this.zIndex=this.pos.y;},updateZindex:function(){if(this.vel.y!==0){this.zIndex=this.pos.y;ig.game.sortEntitiesDeferred();}},update:function(){this.parent();if(this.vel.x!==0||this.vel.y!==0){this.updateZindex();}}});ig.EntityPool.enableFor(EntityCollectable);});

// lib/game/entities/potion.js
ig.baked=true;ig.module('game.entities.potion').requires('game.entities.collectable').defines(function(){EntityPotion=EntityCollectable.extend({animSheet:new ig.AnimationSheet('media/potion.png',7,7),size:{x:7,y:7},offset:{x:0,y:0},health:1,sPotion:new ig.Sound('media/sounds/potion.mp3',false),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[0,0,0,0,0,0,0,0,0,0,1,2]);this.currentAnim.gotoRandomFrame();},reset:function(x,y,settings){this.parent(x,y,settings);this.currentAnim.gotoRandomFrame();},check:function(other){if(other instanceof EntityPlayer){this.sPotion.play();other.poisonTimer.set(0);other.health+=this.health;if(other.health>other.maxHealth)other.health=other.maxHealth;this.kill();}
this.parent();},});});

// lib/game/entities/gold.js
ig.baked=true;ig.module('game.entities.gold').requires('game.entities.collectable').defines(function(){EntityGold=EntityCollectable.extend({animSheet:new ig.AnimationSheet('media/gold.png',4,8),size:{x:4,y:3},offset:{x:0,y:5},gold:1,goldTime:7,timer:new ig.Timer(),collectRange:20,movement:30,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[3,4,5]);this.addAnim('drop',0.1,[0,1,2]);this.currentAnim=this.anims['drop'];this.currentAnim.rewind();this.gold=settings.gold;this.drop=true;this.timer.set(this.goldTime);},reset:function(x,y,settings){this.parent(x,y,settings);this.currentAnim.rewind();this.gold=settings.gold;this.drop=true;this.timer.set(this.goldTime);},check:function(other){if(other instanceof EntityPlayer){other.gold+=this.gold;ig.game.spawnEntity(EntityMsg,other.pos.x,other.pos.y-6,{msg:'+'+this.gold,blue:true});this.kill();}
this.parent();},update:function(){this.parent();if(this.drop&&this.currentAnim.loopCount>0){this.drop=false;this.currentAnim=this.anims['idle'];}
if(this.timer.delta()>0){this.kill();}
var hero=ig.game.getEntityByName('robin');if(hero){if(hero.distanceTo(this)<this.collectRange){if(this.pos.x>hero.pos.x+4||this.pos.x<hero.pos.x-4){if(this.pos.x>hero.pos.x){this.vel.x=-this.movement;this.flip=false;}
if(this.pos.x<=hero.pos.x){this.vel.x=this.movement;this.flip=true;}}
if(this.pos.y>hero.pos.y+4||this.pos.y<hero.pos.y-4){if(this.pos.y>hero.pos.y){this.vel.y=-this.movement;}
if(this.pos.y<=hero.pos.y){this.vel.y=this.movement;}}}else{if(this.vel.x>0)this.vel.x-=1;if(this.vel.x<0)this.vel.x+=1;if(this.vel.y>0)this.vel.y-=1;if(this.vel.y<0)this.vel.y+=1;}}},draw:function(){if(this.timer.delta()>-1){if(this.timer.delta().toFixed(1)%0.1==0){return;}}
this.parent();}});});

// lib/game/entities/web.js
ig.baked=true;ig.module('game.entities.web').requires('game.entities.particle').defines(function(){EntityWeb=EntityParticle.extend({animSheet:new ig.AnimationSheet('media/web.png',17,14),size:{x:17,y:14},offset:{x:0,y:0},lifetime:10,fadetime:8,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',1,[0]);},reset:function(x,y,settings){this.parent(x,y,settings);this.timer.set(0);},});});

// lib/game/entities/fire.js
ig.baked=true;ig.module('game.entities.fire').requires('impact.entity').defines(function(){EntityFire=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.BOTH,collides:ig.Entity.COLLIDES.NONE,animSheet:new ig.AnimationSheet('media/fire.png',12,28),size:{x:11,y:5},offset:{x:0,y:23},init:function(x,y,settings){this.parent(x,y,settings);this.zIndex=this.pos.y;this.addAnim('idle',0.2,[0,1,2,3,4,5]);this.currentAnim.gotoRandomFrame();this.zIndex=this.pos.y;},check:function(other){other.receiveDamage(1,false,{x:this.pos.x,y:this.pos.y},50);this.parent();},});});

// lib/game/entities/bush.js
ig.baked=true;ig.module('game.entities.bush').requires('impact.entity').defines(function(){EntityBush=ig.Entity.extend({animSheet:new ig.AnimationSheet('media/maps/green_extras.png',16,16),size:{x:16,y:16},position:'top',init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('top',1,[0,1,2]);this.addAnim('bottom',1,[3,4,5]);this.addAnim('left',1,[6,7,8]);this.addAnim('right',1,[9,10,11]);this.position=settings.position;this.currentAnim=this.anims[this.position];this.currentAnim.gotoRandomFrame();},update:function(){}});});

// lib/game/entities/hit.js
ig.baked=true;ig.module('game.entities.hit').requires('game.entities.particle').defines(function(){EntityHit=EntityParticle.extend({animSheet:new ig.AnimationSheet('media/hit.png',9,9),size:{x:9,y:9},offset:{x:0,y:0},lifetime:0.1,zIndex:9999,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',1,[0]);},reset:function(x,y,settings){this.parent(x,y,settings);this.timer.set(0);},});});

// lib/game/entities/msg.js
ig.baked=true;ig.module('game.entities.msg').requires('game.entities.particle').defines(function(){EntityMsg=EntityParticle.extend({fontRed:new ig.Font('media/font/red.png'),fontBlue:new ig.Font('media/font/blue.png'),fontGreen:new ig.Font('media/font/green.png'),lifetime:1.5,fadetime:1,zIndex:9999,init:function(x,y,settings){this.parent(x,y,settings);this.pos.x-=ig.game.screen.x;this.pos.y-=ig.game.screen.y;this.blue=settings.blue;this.green=settings.green;this.message=settings.msg;},reset:function(x,y,settings){this.parent(x,y,settings);this.timer.set(0);this.pos.x-=ig.game.screen.x;this.pos.y-=ig.game.screen.y;this.blue=settings.blue;this.green=settings.green;this.message=settings.msg;},update:function(){this.parent();this.pos.y-=0.25;if(this.blue){this.fontBlue.alpha=this.alpha;}else
if(this.green){this.fontGreen.alpha=this.alpha;}else{this.fontRed.alpha=this.alpha;}},draw:function(){this.parent();if(this.blue){this.fontBlue.draw(this.message,this.pos.x,this.pos.y,ig.Font.ALIGN.CENTER);}else
if(this.green){this.fontGreen.draw(this.message,this.pos.x,this.pos.y,ig.Font.ALIGN.CENTER);}else{this.fontRed.draw(this.message,this.pos.x,this.pos.y,ig.Font.ALIGN.CENTER);}}});});

// lib/game/entities/explosion.js
ig.baked=true;ig.module('game.entities.explosion').requires('game.entities.particle').defines(function(){EntityExplosion=EntityParticle.extend({animSheet:new ig.AnimationSheet('media/explosion.png',16,16),size:{x:8,y:2},offset:{x:4,y:13},lifetime:1,fadetime:999,playOnce:true,attackRange:14,attackDamage:1,stuntTime:0.8,sExplosion:new ig.Sound('media/sounds/explosion.mp3',true),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[0,1,2,3,4,5,6,7,8,9,10,11,12,13]);this.updateZindex();this.giveDamage=true;this.sExplosion.play();},reset:function(x,y,settings){this.parent(x,y,settings);this.updateZindex();this.giveDamage=true;this.playOnce=true;this.currentAnim.rewind();},updateZindex:function(){this.zIndex=this.pos.y;ig.game.sortEntitiesDeferred();this.sExplosion.play();},update:function(){this.parent();if(this.currentAnim.frame==3&&this.giveDamage){for(var i=0;i<ig.game.entities.length;i++){if((ig.game.entities[i]instanceof EntityNPC)||(ig.game.entities[i]instanceof EntityPlayer)){if(ig.game.entities[i].distanceTo(this)<this.attackRange){ig.game.entities[i].receiveDamage(this.attackDamage);}}}
this.giveDamage=false;}}});});

// lib/game/entities/block.js
ig.baked=true;ig.module('game.entities.block').requires('game.entities.particle').defines(function(){EntityBlock=EntityParticle.extend({animSheet:new ig.AnimationSheet('media/block.png',29,13),size:{x:29,y:13},offset:{x:0,y:0},lifetime:1,fadetime:999,playOnce:true,zIndex:1,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[0,1,2,3,4,5]);},reset:function(x,y,settings){this.parent(x,y,settings);this.currentAnim.rewind();},});});

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('impact.game','impact.font','plugins.gamepad','game.levels.menu','game.levels.menuhd','game.levels.intro','game.entities.player','game.entities.npc','game.entities.bat','game.entities.black_knight','game.entities.bridge_keeper','game.entities.ni','game.entities.ni_cloud','game.entities.rabbit','game.entities.spider','game.entities.spider_junior','game.entities.bee','game.entities.gate','game.entities.gate_orange','game.entities.gate_green','game.entities.gate_red','game.entities.gate_blue','game.entities.grail','game.entities.chest','game.entities.collectable','game.entities.potion','game.entities.gold','game.entities.web','game.entities.fire','game.entities.bush','game.entities.particle','game.entities.hit','game.entities.msg','game.entities.explosion','game.entities.block').defines(function(){MyGame=ig.Game.extend({clearColor:"#493c2b",fontWhite:new ig.Font('media/font/white.png'),fontBlack:new ig.Font('media/font/black.png'),debugSheet:new ig.Image('media/debug.png'),logoSheet:new ig.Image('media/logo.png'),logoBigSheet:new ig.Image('media/logo2.png'),gameOverSheet:new ig.Image('media/game_over.png'),bookSheet:new ig.Image('media/book.png'),mapSheet:new ig.Image('media/map_of_the_quest.png'),flagSheet:new ig.Image('media/flag.png'),buttonSheet:new ig.Image('media/button.png'),buttonSmallSheet:new ig.Image('media/button_small.png'),handSheet:new ig.Image('media/hand.png'),touchButtonsSheet:new ig.Image('media/touch_buttons.png'),swordSheet:new ig.Image('media/swords.png'),guiIconsSheet:new ig.Image('media/gui_icons.png'),chestSheet:new ig.Image('media/big_chest.png'),potionSheet:new ig.Image('media/big_potion.png'),panelStats:new ig.Image('media/panel_stats.png'),panelSwords:new ig.Image('media/panel_swords.png'),panelShort:new ig.Image('media/panel_short.png'),panelLong:new ig.Image('media/panel_long.png'),sMenu:new ig.Sound('media/sounds/menu.*',false),debug:false,pause:true,gravity:0,STATE:'intro',timer:new ig.Timer(),respawnTimer:new ig.Timer(),waveTimer:new ig.Timer(),nextWave:15,spawnTime:4,respawnTime:3,wave:0,spawnPotions:3,maxStats:14,showErrorMessage:null,cameraFollow:true,sX:0,sY:0,k:0.98,quest:{levels:[{waves:[{entities:['EntityBee','EntityBee','EntityBee']},{entities:['EntityBee','EntityBee','EntityBee','EntityBee','EntityBee']},{entities:['EntityBee','EntityBee','EntityBee','EntityBee','EntityBee']},{entities:['EntityBee','EntityBee','EntityBee','EntityBee','EntityBee']},{entities:['EntityBee','EntityBee','EntityBee','EntityBee','EntityBee']},],title:'Title of the first map',open:true},{waves:[{entities:['EntitySpiderJunior','EntitySpiderJunior','EntitySpider']},{entities:['EntityBridgeKeeper','EntitySpider']},{entities:['EntityBridgeKeeper','EntityBridgeKeeper','EntityNi']},{entities:['EntityNi','EntityNi','EntityRabbit']},{entities:['EntityRabbit','EntityRabbit','EntityRabbit','EntityRabbit']}],title:'Title of the second map',open:true},{waves:[{entities:['EntityBat']},{entities:['EntityBat','EntityBat']},{entities:['EntityBat','EntityBat','EntitySpiderJunior']},{entities:['EntityBridgeKeeper','EntityBat','EntitySpiderJunior']},{entities:['EntityBridgeKeeper','EntityRabbit','EntitySpiderJunior','EntitySpider']},{entities:['EntityBlackKnight','EntityBlackKnight','EntitySpider','EntitySpider']}],title:'Title of the third map',open:true},{waves:[{entities:['EntitySpiderJunior','EntitySpiderJunior']},{entities:['EntitySpiderJunior','EntitySpiderJunior','EntitySpiderJunior']},{entities:['EntityBat','EntityBat','EntitySpiderJunior']},{entities:['EntityBridgeKeeper','EntityBat','EntitySpiderJunior']},{entities:['EntityBridgeKeeper','EntityRabbit','EntitySpiderJunior','EntitySpider']},{entities:['EntityBlackKnight','EntityBlackKnight','EntitySpider','EntitySpider']}],title:'Title of the fourth map',open:true},{waves:[],title:'Title of the five map',open:false}],currentLevel:0},stats:{gold:50,potions:1,points:7,maxStats:12,health:1,maxHealth:1,attack:1,defence:1},swords:[{active:true,owned:true,price:0,name:'Air',attack:{min:1,max:2,},charge:0.5,chargePercentage:100,timer:new ig.Timer()},{active:false,owned:false,price:50,name:'Water',attack:{min:3,max:3,},charge:0.8,chargePercentage:100,cold:true,timer:new ig.Timer()},{active:false,owned:false,price:100,name:'Fire',attack:{min:1,max:6,},charge:1.5,chargePercentage:100,fire:true,timer:new ig.Timer()},{active:false,owned:false,price:60,name:'Earth',attack:{min:2,max:4,},charge:1.2,chargePercentage:100,timer:new ig.Timer()}],activeSword:0,potions:{price:20,quantity:1,health:1,},defence:{range:20,charge:4,protection:2,chargePercentage:100,missFactor:2,protectionTimer:new ig.Timer(),timer:new ig.Timer()},highScoreTable:'22266',minGameScoreToHighscore:35,scoresFromGameJolt:0,score:0,gold:0,lastScore:0,NPCs:0,GUI:{},pointer:{state:0,pos:{x:0,y:0},pos2:{x:10,y:10},currentRoad:{x:0,y:0},road:{quest:[[]],help:[[]],hero:[[],[],[],[]],shop:[[],[],[]],map:[[]]}},proceduralMap:{},init:function(){this.GUI.centerTop={x:ig.system.width*0.5,y:12};this.GUI.centerMiddle={x:ig.system.width*0.5,y:50};this.GUI.centerBottom={x:ig.system.width*0.5,y:ig.system.height-12};this.GUI.stats={x:ig.system.width*0.5,y:50};this.GUI.shop={x:ig.system.width*0.5,y:24};this.GUI.map={x:ig.system.width*0.5,y:66};this.pointer.road.quest[0][0]={x:this.GUI.centerMiddle.x+46,y:this.GUI.centerMiddle.y+98,action:'next'};this.pointer.road.help[0][0]={x:this.GUI.centerMiddle.x+46,y:this.GUI.centerMiddle.y+98,action:'next'};this.pointer.road.hero[0][1]={x:this.GUI.centerBottom.x+38,y:this.GUI.centerBottom.y-5,action:'next'};this.pointer.road.hero[0][0]={x:this.GUI.centerBottom.x-32,y:this.GUI.centerBottom.y-5,action:'auto'};this.pointer.road.hero[1][0]={x:this.GUI.stats.x+51,y:this.GUI.stats.y+14,action:'add',value:'health'};this.pointer.road.hero[1][1]={x:this.GUI.stats.x+41,y:this.GUI.stats.y+14,action:'remove',value:'health'};this.pointer.road.hero[2][0]={x:this.GUI.stats.x+51,y:this.GUI.stats.y+24,action:'add',value:'attack'};this.pointer.road.hero[2][1]={x:this.GUI.stats.x+41,y:this.GUI.stats.y+24,action:'remove',value:'attack'};this.pointer.road.hero[3][0]={x:this.GUI.stats.x+51,y:this.GUI.stats.y+34,action:'add',value:'defence'};this.pointer.road.hero[3][1]={x:this.GUI.stats.x+41,y:this.GUI.stats.y+34,action:'remove',value:'defence'};this.pointer.road.shop[1][0]={x:this.GUI.shop.x-77,y:this.GUI.shop.y+84,action:'sword',value:0};this.pointer.road.shop[1][1]={x:this.GUI.shop.x-16,y:this.GUI.shop.y+84,action:'sword',value:1};this.pointer.road.shop[1][2]={x:this.GUI.shop.x+45,y:this.GUI.shop.y+84,action:'sword',value:2};this.pointer.road.shop[1][3]={x:this.GUI.shop.x+106,y:this.GUI.shop.y+84,action:'sword',value:3};this.pointer.road.shop[2][0]={x:this.GUI.shop.x+20,y:this.GUI.shop.y+112,action:'potion'};this.pointer.road.shop[0][0]={x:this.GUI.centerBottom.x+82,y:this.GUI.centerBottom.y-6,action:'next'};this.pointer.road.map[0][0]={x:this.GUI.map.x-67,y:this.GUI.map.y+30,action:'chooseLevel',value:0};this.pointer.road.map[0][1]={x:this.GUI.map.x-11,y:this.GUI.map.y+26,action:'chooseLevel',value:1};this.pointer.road.map[0][2]={x:this.GUI.map.x+19,y:this.GUI.map.y+18,action:'chooseLevel',value:2};this.pointer.road.map[0][3]={x:this.GUI.map.x+39,y:this.GUI.map.y+33,action:'chooseLevel',value:3};this.pointer.road.map[0][4]={x:this.GUI.map.x+66,y:this.GUI.map.y+18,action:'chooseLevel',value:4};ig.input.bind(ig.KEY.LEFT_ARROW,'left');ig.input.bind(ig.KEY.RIGHT_ARROW,'right');ig.input.bind(ig.KEY.UP_ARROW,'up');ig.input.bind(ig.KEY.DOWN_ARROW,'down');ig.input.bind(ig.KEY.X,'attack');ig.input.bind(ig.KEY.S,'defence');ig.input.bind(ig.KEY.ENTER,'action');ig.input.bind(ig.KEY.M,'quest');ig.input.bind(ig.KEY.F,'secretA');ig.input.bind(ig.KEY.J,'secretB');Gamepad.mappings.one=[['dpadUp','up'],['dpadDown','down'],['dpadLeft','left'],['dpadRight','right'],['leftStickX','left','right'],['leftStickY','up','down'],['faceButton0','attack'],['faceButton1','defence'],['faceButton2','action'],['faceButton3','action4']];ig.music.add('media/music/menu.mp3');ig.music.volume=0.7;this.loadLevel(LevelMenuhd);this.screen.y=5;this.loadHightScores();ig.music.play();},generateProceduralMap:function(params){var proceduralMap={entities:[],layer:[]}
var blueprint={width:28,height:14,spaceSize:8,tileSize:16,gates:['top','left',false,false],river:false,grass:params.grass,grassProbability:50,bushes:params.bushes,bushesProbability:40,spriteSheet:'media/maps/'+params.spriteSheet,tiles:{placeholder:34,floor:33,space:[35,36,37,38],walls:{top:[1,2,3,4],bottom:[5,6,7,8],left:[9,10,11,12],right:[13,14,15,16],outsideCorners:[17,18,25,26],insideCorners:[19,20,27,28],},collision:{insideCorners:[35,13,24,2],},shadowCorners:[21,22,29,30],grass:[25,26,27,28,29,30],},},mapData=[],collisionData=[],spaceData=[],extrasData=[];var rooms={minWidth:6,minHeight:3,small:3,list:[],}
initMap=function(){for(var y=0;y<blueprint.height;y++){mapData[y]=[blueprint.width];collisionData[y]=[blueprint.width];extrasData[y]=[blueprint.width];}
for(var y=0;y<blueprint.height;y++){for(var x=0;x<blueprint.width;x++){mapData[y][x]=0;collisionData[y][x]=0;extrasData[y][x]=0;}}
for(var y=0;y<blueprint.spaceSize;y++){spaceData[y]=[blueprint.spaceSize];}
for(var y=0;y<blueprint.spaceSize;y++){for(var x=0;x<blueprint.spaceSize;x++){spaceData[y][x]=blueprint.tiles.space[(Math.random()*blueprint.tiles.space.length)<<0];}}}
insertRoom=function(params){for(var i=0;i<params.height;i++){for(var j=0;j<params.width;j++){mapData[params.y+i][params.x+j]=blueprint.tiles.floor;};};}
clearArtifacts=function(){for(var y=1;y<blueprint.height-1;y++){for(var x=1;x<blueprint.width-1;x++){if(mapData[y][x]==0){if(mapData[y-1][x]!==0&&mapData[y+1][x]!==0)mapData[y][x]=blueprint.tiles.floor;if(mapData[y][x-1]!==0&&mapData[y][x+1]!==0)mapData[y][x]=blueprint.tiles.floor;}}}}
insertCollisions=function(){for(var y=1;y<blueprint.height-1;y++){for(var x=1;x<blueprint.width-1;x++){if(mapData[y][x]!==0){collisionData[y-1][x]=mapData[y-1][x]==0?1:0;collisionData[y+1][x]=mapData[y+1][x]==0?1:0;collisionData[y][x-1]=mapData[y][x-1]==0?1:0;collisionData[y][x+1]=mapData[y][x+1]==0?1:0;}};};}
insertWalls=function(){for(var y=0;y<blueprint.height;y++){for(var x=0;x<blueprint.width;x++){if(collisionData[y][x]!==0){if(mapData[y+1]!==undefined&&mapData[y+1][x]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.top[(Math.random()*blueprint.tiles.walls.top.length)<<0];else
if(mapData[y-1]!==undefined&&mapData[y-1][x]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.bottom[(Math.random()*blueprint.tiles.walls.bottom.length)<<0];else
if(mapData[y][x+1]!==undefined&&mapData[y][x+1]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.left[(Math.random()*blueprint.tiles.walls.left.length)<<0];else
if(mapData[y][x-1]!==undefined&&mapData[y][x-1]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.right[(Math.random()*blueprint.tiles.walls.right.length)<<0];if(mapData[y+1]!==undefined&&mapData[y][x+1]!==undefined&&mapData[y+1][x]==blueprint.tiles.floor&&mapData[y][x+1]==blueprint.tiles.floor){mapData[y][x]=blueprint.tiles.walls.insideCorners[0];collisionData[y][x]=blueprint.tiles.collision.insideCorners[0];}
if(mapData[y+1]!==undefined&&mapData[y][x-1]!==undefined&&mapData[y+1][x]==blueprint.tiles.floor&&mapData[y][x-1]==blueprint.tiles.floor){mapData[y][x]=blueprint.tiles.walls.insideCorners[1];collisionData[y][x]=blueprint.tiles.collision.insideCorners[1];}
if(mapData[y-1]!==undefined&&mapData[y][x+1]!==undefined&&mapData[y-1][x]==blueprint.tiles.floor&&mapData[y][x+1]==blueprint.tiles.floor){mapData[y][x]=blueprint.tiles.walls.insideCorners[2];collisionData[y][x]=blueprint.tiles.collision.insideCorners[2];}
if(mapData[y-1]!==undefined&&mapData[y][x-1]!==undefined&&mapData[y-1][x]==blueprint.tiles.floor&&mapData[y][x-1]==blueprint.tiles.floor){mapData[y][x]=blueprint.tiles.walls.insideCorners[3];collisionData[y][x]=blueprint.tiles.collision.insideCorners[3];}}else{if(mapData[y][x]==0){if(collisionData[y+1]!==undefined&&collisionData[y][x+1]!==undefined&&collisionData[y+1][x]!==0&&collisionData[y][x+1]!==0&&mapData[y+1][x+1]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.outsideCorners[0];if(collisionData[y+1]!==undefined&&collisionData[y][x-1]!==undefined&&collisionData[y+1][x]!==0&&collisionData[y][x-1]!==0&&mapData[y+1][x-1]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.outsideCorners[1];if(collisionData[y-1]!==undefined&&collisionData[y][x+1]!==undefined&&collisionData[y-1][x]!==0&&collisionData[y][x+1]!==0&&mapData[y-1][x+1]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.outsideCorners[2];if(collisionData[y-1]!==undefined&&collisionData[y][x-1]!==undefined&&collisionData[y-1][x]!==0&&collisionData[y][x-1]!==0&&mapData[y-1][x-1]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.walls.outsideCorners[3];}}};};}
insertShadows=function(){for(var y=1;y<blueprint.height-1;y++){for(var x=1;x<blueprint.width-1;x++){if(collisionData[y-1][x]==1&&collisionData[y][x-1]==1&&collisionData[y][x]==0&&mapData[y][x]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.shadowCorners[0];if(collisionData[y-1][x]==1&&collisionData[y][x+1]==1&&collisionData[y][x]==0&&mapData[y][x]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.shadowCorners[1];if(collisionData[y+1][x]==1&&collisionData[y][x-1]==1&&collisionData[y][x]==0&&mapData[y][x]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.shadowCorners[2];if(collisionData[y+1][x]==1&&collisionData[y][x+1]==1&&collisionData[y][x]==0&&mapData[y][x]==blueprint.tiles.floor)mapData[y][x]=blueprint.tiles.shadowCorners[3];}}}
fixCollisions=function(){for(var y=0;y<blueprint.height;y++){for(var x=0;x<blueprint.width;x++){if(mapData[y][x]==blueprint.tiles.walls.outsideCorners[0]||mapData[y][x]==blueprint.tiles.walls.outsideCorners[1]||mapData[y][x]==blueprint.tiles.walls.outsideCorners[2]||mapData[y][x]==blueprint.tiles.walls.outsideCorners[3]){collisionData[y][x]=1;}}}}
insertGrails=function(){for(var i=0;i<rooms.list.length;i++){proceduralMap.entities.push({type:"EntityGrail",x:rooms.list[i].x*blueprint.tileSize,y:rooms.list[i].y*blueprint.tileSize,settings:{}});};}
insertGates=function(){var billGates={top:[],bottom:[],left:[],right:[]},position;for(var y=2;y<blueprint.height-2;y++){for(var x=2;x<blueprint.width-2;x++){if(collisionData[y-2][x]==1&&collisionData[y-1][x]==1&&collisionData[y][x]==1&&collisionData[y+1][x]==1&&collisionData[y+2][x]==1){position=x>rooms.list[0].x?'right':'left';billGates[position].push({x:x,y:y,});}
if(collisionData[y][x-2]==1&&collisionData[y][x-1]==1&&collisionData[y][x]==1&&collisionData[y][x+1]==1&&collisionData[y][x+2]==1){position=y>rooms.list[0].y?'bottom':'top';billGates[position].push({x:x,y:y,});}}}
var randomGate={top:(Math.random()*billGates.top.length)<<0,bottom:(Math.random()*billGates.bottom.length)<<0,left:(Math.random()*billGates.left.length)<<0,right:(Math.random()*billGates.right.length)<<0,}
function capitaliseFirstLetter(string)
{return string.charAt(0).toUpperCase()+string.slice(1);}
for(var i=0;i<4;i++){if(blueprint.gates[i]){var pos=blueprint.gates[i],type;if(billGates[pos].length){mapData[billGates[pos][randomGate[pos]].y][billGates[pos][randomGate[pos]].x]=0;proceduralMap.entities.push({type:'EntityGate'+capitaliseFirstLetter(params.spriteSheet),x:billGates[pos][randomGate[pos]].x*blueprint.tileSize,y:billGates[pos][randomGate[pos]].y*blueprint.tileSize,settings:{"position":pos}});}}};}
insertBushes=function(freeSpace){var position,p;for(var y=2;y<blueprint.height-2;y++){for(var x=2;x<blueprint.width-2;x++){if(collisionData[y-2][x]==1&&collisionData[y-1][x]==1&&collisionData[y][x]==1&&collisionData[y+1][x]==1&&collisionData[y+2][x]==1){position=(mapData[y][x+1]!==0&&mapData[y][x-1]==0)?'left':'right';p=position=='right'?-6:6;if((Math.random()*100)<<0<40&&mapData[y][x]!==0){proceduralMap.entities.push({type:'EntityBush',x:(x*blueprint.tileSize)+p,y:y*blueprint.tileSize,settings:{"position":position}});}}
if(collisionData[y][x-2]==1&&collisionData[y][x-1]==1&&collisionData[y][x]==1&&collisionData[y][x+1]==1&&collisionData[y][x+2]==1){position=mapData[y-1][x]!==0?'bottom':'top';p=position=='bottom'?-6:6;if((Math.random()*100)<<0<blueprint.bushesProbability&&mapData[y][x]!==0){proceduralMap.entities.push({type:'EntityBush',x:x*blueprint.tileSize,y:(y*blueprint.tileSize)+p,settings:{"position":position}});}}}}}
insertGrass=function(){for(var y=0;y<blueprint.height;y++){for(var x=0;x<blueprint.width;x++){if((Math.random()*100)<<0<blueprint.grassProbability&&mapData[y][x]==blueprint.tiles.floor){extrasData[y][x]=blueprint.tiles.grass[(Math.random()*blueprint.tiles.grass.length)<<0];}}}}
fillSpace=function(){for(var y=0;y<blueprint.height;y++){for(var x=0;x<blueprint.width;x++){if(mapData[y][x]==0){mapData[y][x]=blueprint.tiles.space[(Math.random()*blueprint.tiles.space.length)<<0];}}}}
printMap=function(){var str;for(var y=0;y<blueprint.height;y++){str='';for(var x=0;x<blueprint.width;x++){str+=' '+mapData[y][x];}
console.log(str);}}
initMap();var main={};main.w=blueprint.width-rooms.small-((Math.random()*(blueprint.width*0.4))<<0);main.h=blueprint.height-(rooms.small*2)-((Math.random()*(blueprint.height*0.4))<<0);main.x=((blueprint.width*0.5)-(main.w*0.5))<<0;main.y=((blueprint.height*0.5)-(main.h*0.5))<<0;if(main.w<rooms.minWidth)main.w=rooms.minWidth;if(main.h<rooms.minHeight)main.h=rooms.minHeight;insertRoom({x:main.x,y:main.y,width:main.w,height:main.h});rooms.list.push({x:main.x+(main.w*0.5)<<0,y:main.y+(main.h*0.5)<<0});if(main.x>1&&main.y>2){var w=4+(Math.random()*rooms.small)<<0,h=2+(Math.random()*rooms.small)<<0,x=(main.x+1)-((w*0.5)<<0)+(Math.random()*w)<<0,y=main.y-(h)+(Math.random()*(h*0.5))<<0;if(x<=0)x=1;if(y<=0)y=1;if(x+w>=blueprint.width)x=blueprint.width-w-2;if(y+h>=blueprint.height)y=blueprint.height-w-2;if(w<rooms.small)w=rooms.small;if(h<rooms.small)h=rooms.small;insertRoom({x:x,y:y,width:w,height:h});rooms.list.push({x:x+(w*0.5)<<0,y:y+(h*0.5)<<0});}
if(main.x+main.w+2<blueprint.width&&main.y>1){var w=4+(Math.random()*rooms.small)<<0,h=2+(Math.random()*rooms.small)<<0,x=(main.x+main.w-1)+((w*0.5)<<0)-(Math.random()*w)<<0,y=main.y-((w*0.5)<<0)+(Math.random()*(w*0.5))<<0;if(x<=0)x=1;if(y<=0)y=1;if(x+w>=blueprint.width)x=blueprint.width-w-2;if(y+h>=blueprint.height)y=blueprint.height-w-2;if(w<rooms.small)w=rooms.small;if(h<rooms.small)h=rooms.small;insertRoom({x:x,y:y,width:w,height:h});rooms.list.push({x:x+(w*0.5)<<0,y:y+(h*0.5)<<0});}
if(main.x>1&&main.y+main.h+2<blueprint.height){var w=4+(Math.random()*rooms.small)<<0,h=2+(Math.random()*rooms.small)<<0,x=(main.x+1)-((w*0.5)<<0)+(Math.random()*w)<<0,y=main.y+main.h-(Math.random()*(h*0.5))<<0;if(x<=0)x=1;if(y<=0)y=1;if(x+w>=blueprint.width)x=blueprint.width-w-2;if(y+h>=blueprint.height)y=blueprint.height-w-2;if(w<rooms.small)w=rooms.small;if(h<rooms.small)h=rooms.small;insertRoom({x:x,y:y,width:w,height:h});rooms.list.push({x:x+(w*0.5)<<0,y:y+(h*0.5)<<0});}
if(main.x+main.w+1<blueprint.width&&main.y+main.h+2<blueprint.height){var w=4+(Math.random()*rooms.small)<<0,h=2+(Math.random()*rooms.small)<<0,x=(main.x+main.w-1)+((w*0.5)<<0)-(Math.random()*w)<<0,y=main.y+main.h-(Math.random()*(w*0.5))<<0;if(x<=0)x=1;if(y<=0)y=1;if(x+w>=blueprint.width)x=blueprint.width-w-2;if(y+h>=blueprint.height)y=blueprint.height-w-2;if(w<rooms.small)w=rooms.small;if(h<rooms.small)h=rooms.small;insertRoom({x:x,y:y,width:w,height:h});rooms.list.push({x:x+(w*0.5)<<0,y:y+(h*0.5)<<0});}
clearArtifacts();insertCollisions();insertWalls();insertShadows();fixCollisions();insertGates();if(blueprint.bushes)insertBushes();if(blueprint.grass)insertGrass();insertGrails();fillSpace();proceduralMap.layer.push({name:"space",tilesetName:blueprint.spriteSheet+'.png',repeat:true,distance:1,tilesize:blueprint.tileSize,"width":blueprint.spaceSize*blueprint.tilesize,"height":blueprint.spaceSize*blueprint.tilesize,foreground:false,data:spaceData,});proceduralMap.layer.push({name:"dungeons",tilesetName:blueprint.spriteSheet+'.png',repeat:false,distance:1,tilesize:blueprint.tileSize,"width":blueprint.width*blueprint.tilesize,"height":blueprint.height*blueprint.tilesize,foreground:false,data:mapData,});proceduralMap.layer.push({name:"extras",tilesetName:blueprint.spriteSheet+'_extras.png',repeat:false,distance:1,tilesize:blueprint.tileSize,"width":blueprint.width*blueprint.tilesize,"height":blueprint.height*blueprint.tilesize,foreground:false,data:extrasData,});proceduralMap.layer.push({name:"collision",repeat:false,tilesize:blueprint.tileSize,"width":blueprint.width*blueprint.tilesize,"height":blueprint.height*blueprint.tilesize,"visible":0,"tilesetName":"",data:collisionData,});return proceduralMap;},connectToGameJolt:function(params){var url,privateKey='67153e1c20bcd89b7da31a320f00603e',gameID='21623';if(params.type=='add_score'){url="http://gamejolt.com/api/game/v1/scores/add/?game_id="+gameID+"&score='"+params.score+" points'&sort="+params.score+"&guest="+params.name+"&table_id="+params.highScoreTable;}
if(params.type=='get_scores'){url="http://gamejolt.com/api/game/v1/scores/?game_id="+gameID+"&format=json&limit=99999&table_id="+params.highScoreTable;}
var hashURL=CryptoJS.SHA1(url+privateKey);var xhr=new XMLHttpRequest();xhr.open('GET',url+'&signature='+hashURL);xhr.onreadystatechange=function(data){if(xhr.readyState==4){ig.game.scoresFromGameJolt=JSON.parse(xhr.response);}}
xhr.send();},loadHightScores:function(){this.scoresFromGameJolt=false;this.connectToGameJolt({type:'get_scores',highScoreTable:this.highScoreTable});},sendHighscore:function(){if(this.lastScore>this.minGameScoreToHighscore){this.connectToGameJolt({type:'add_score',score:this.lastScore,highScoreTable:this.highScoreTable,name:'Brave Sir Robin'});}},clearLevel:function(){for(var i=0;i<this.entities.length;i++){this.entities[i]=null;}
this.timer.set(0);this.waveTimer.set(0);this.wave=0;},countNPCs:function(){this.NPCs=0;for(var i=0;i<ig.game.entities.length;i++){if(ig.game.entities[i]instanceof EntityNPC){this.NPCs++;}}},pointerMovement:function(){this.pointer.pos.x=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].x;this.pointer.pos.y=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].y;if(ig.input.pressed('action')){this.pointer.state=1;}
if(ig.input.released('action')){this.pointer.state=0;}
if(ig.input.pressed('right')){this.sMenu.play();this.pointer.currentRoad.x+=1;if(this.pointer.currentRoad.x>this.pointer.road[this.STATE][this.pointer.currentRoad.y].length-1){this.pointer.currentRoad.x=0;}}
if(ig.input.pressed('left')){this.sMenu.play();this.pointer.currentRoad.x-=1;if(this.pointer.currentRoad.x<0){this.pointer.currentRoad.x=this.pointer.road[this.STATE][this.pointer.currentRoad.y].length-1;}}
if(ig.input.pressed('down')){this.sMenu.play();this.pointer.currentRoad.y+=1;if(this.pointer.currentRoad.y>this.pointer.road[this.STATE].length-1){this.pointer.currentRoad.y=0;}
if(!this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x]){this.pointer.currentRoad.x=0;}}
if(ig.input.pressed('up')){this.sMenu.play();this.pointer.currentRoad.y-=1;if(this.pointer.currentRoad.y<0){this.pointer.currentRoad.y=this.pointer.road[this.STATE].length-1;}
if(!this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x]){this.pointer.currentRoad.x=0;}}},drawDebug:function(){for(var i=0;i<this.pointer.road[this.STATE].length;i++){for(var j=0;j<this.pointer.road[this.STATE][i].length;j++){this.debugSheet.draw(this.pointer.road[this.STATE][i][j].x,this.pointer.road[this.STATE][i][j].y);};};},loadNewLevel:function(level){if(level===false){level=this.quest.currentLevel;}
if(level==0){this.proceduralMap=this.generateProceduralMap({spriteSheet:'green',grass:true,bushes:true});}
if(level==1){this.proceduralMap=this.generateProceduralMap({spriteSheet:'orange',grass:false,bushes:false});this.quest.currentLevel=1;}
if(level==2){this.proceduralMap=this.generateProceduralMap({spriteSheet:'red',grass:false,bushes:false});this.quest.currentLevel=2;}
if(level==3){this.proceduralMap=this.generateProceduralMap({spriteSheet:'blue',grass:false,bushes:false});this.quest.currentLevel=3;}
this.loadLevel(this.proceduralMap);this.sX=((this.collisionMap.width*0.5)<<0)*this.collisionMap.tilesize;this.sY=((this.collisionMap.height*0.5)<<0)*this.collisionMap.tilesize;this.startGame();},spawnPlayer:function(instant){ig.game.spawnEntity(EntityPlayer,(this.collisionMap.width*16)*0.5,(this.collisionMap.height*16)*0.5);},startGame:function(){this.STATE='game';this.timer.set(0);this.pause=false;this.spawnPlayer();},endGame:function(){this.sendHighscore();this.lastScore=this.score;this.score=0;this.STATE='game_over';this.pause=true;for(var i=0;i<ig.game.entities.length;i++){ig.game.entities[i].kill();};},levelClear:function(){this.lastScore=this.score;this.score=0;var robin=this.getEntityByName('robin');this.stats.gold+=robin.gold;for(var i=0;i<ig.game.entities.length;i++){if(ig.game.entities[i].name=='grail'){this.stats.points+=1;}};if(this.quest.currentLevel<this.quest.levels.length)
this.quest.levels[this.quest.currentLevel+1].open=true;ig.music.play();this.clearLevel();this.loadLevel(LevelMenuhd);this.STATE='hero';},calculatePercentage:function(){var t=this.swords[this.activeSword].timer.delta().toFixed(1)*(-10);var a=this.swords[this.activeSword].charge*10;var p=Math.round((t/a)*100);p=p<0?0:p;this.swords[this.activeSword].chargePercentage=p;t=this.defence.timer.delta().toFixed(1)*(-10);a=this.defence.charge*10;p=Math.round((t/a)*100);p=p<0?0:p;this.defence.chargePercentage=p;},centerCamera:function(){var robin=this.getEntityByName('robin');if(robin){this.sX=this.k*this.sX+(1.0-this.k)*robin.pos.x;this.sY=this.k*this.sY+(1.0-this.k)*robin.pos.y;}
this.screen.x=this.sX-ig.system.width*0.5;this.screen.y=this.sY-ig.system.height*0.5;},update:function(){Gamepad.handleInput();this.parent();if(this.STATE=='hero'||this.STATE=='shop'||this.STATE=='quest'||this.STATE=='help'){this.screen.y=5;}
if(this.STATE=='map'){this.pointerMovement();var action=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].action,value=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].value;if(ig.input.released('action')){if(action=='chooseLevel'){if(this.quest.levels[value].open){ig.music.fadeOut(1);this.loadNewLevel(value);}}}}
if(this.STATE=='shop'){this.pointerMovement();var action=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].action,value=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].value;if(ig.input.released('action')){if(action=='sword'){if(this.swords[value].owned&&!this.swords[value].active){for(var i=0;i<this.swords.length;i++){this.swords[i].active=false;};this.swords[value].active=true;this.activeSword=value;}
if(!this.swords[value].owned){if(this.swords[value].price<=this.stats.gold){this.stats.gold-=this.swords[value].price;this.swords[value].owned=true;}}}
if(action=='potion'){if(this.potions.price<=this.stats.gold){this.stats.gold-=this.potions.price;this.potions.quantity+=4;}}
if(action=='next'){this.STATE='map';this.pointer.currentRoad={x:0,y:0};return;}}}
if(this.STATE=='hero'){this.pointerMovement();var action=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].action,value=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].value;if(ig.input.released('action')){if(action=='add'){if(this.stats[value]<this.stats.maxStats&&this.stats.points>0){this.stats[value]+=1;this.stats.points-=1;}}
if(action=='remove'){if(this.stats[value]>1){this.stats[value]-=1;this.stats.points+=1;}}
if(action=='auto'){for(var i=0;i<=this.stats.points;i++){if(this.stats.points>0&&this.stats.health<this.maxStats){this.stats.points-=1;this.stats.health+=1;}
if(this.stats.points>0&&this.stats.health<this.maxStats){this.stats.points-=1;this.stats.health+=1;}
if(this.stats.points>0&&this.stats.health<this.maxStats){this.stats.points-=1;this.stats.health+=1;}
if(this.stats.points>0&&this.stats.attack<this.maxStats){this.stats.points-=1;this.stats.attack+=1;}
if(this.stats.points>0&&this.stats.attack<this.maxStats){this.stats.points-=1;this.stats.attack+=1;}
if(this.stats.points>0&&this.stats.defence<this.maxStats){this.stats.points-=1;this.stats.defence+=1;}}
this.pointer.currentRoad={x:1,y:0};}
if(action=='next'){this.STATE='shop';this.pointer.currentRoad={x:0,y:0};return;}}}
if(this.STATE=='help'){this.pointerMovement();var action=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].action;if(ig.input.released('action')){if(action=='next'){this.STATE='hero';this.pointer.currentRoad={x:0,y:0};return;}}}
if(this.STATE=='quest'){this.pointerMovement();var action=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].action;if(ig.input.released('action')){if(action=='next'){this.STATE='help';this.pointer.currentRoad={x:0,y:0};return;}}}
if(this.STATE=='intro'){if(ig.input.released('action')){this.loadLevel(LevelMenuhd);this.STATE='quest';this.pointer.currentRoad={x:0,y:0};return;}}
if(this.STATE=='game'){if(this.cameraFollow)this.centerCamera();this.calculatePercentage();if(this.wave<this.quest.levels[this.quest.currentLevel].waves.length){if(this.waveTimer.delta()>0){for(var i=0;i<this.entities.length;i++){if(this.entities[i]instanceof EntityGate){this.entities[i].open();}}
this.wave++;this.waveTimer.set(this.nextWave);}}else{this.countNPCs();if(this.NPCs<1){this.levelClear();}}
if(!this.getEntityByName('robin')&&this.respawnTimer.delta()>0){this.spawnPlayer();}
if(ig.game.getEntitiesByType(EntityGrail).length<1){this.endGame();}
if(ig.input.released('quest')){ig.music.play();this.clearLevel();this.loadLevel(LevelMenuhd);this.pointer.currentRoad={x:0,y:0};this.STATE='hero';this.pause=true;return;}
if(ig.input.pressed('secretA')){this.proceduralMap=this.generateProceduralMap({spriteSheet:'orange',grass:false,bushes:false,});this.loadNewLevel('procedural');this.sX=((this.collisionMap.width*0.5)<<0)*this.collisionMap.tilesize;this.sY=((this.collisionMap.height*0.5)<<0)*this.collisionMap.tilesize;}
if(ig.input.pressed('secretB')){this.proceduralMap=this.generateProceduralMap({spriteSheet:'green',grass:true,bushes:true});this.loadNewLevel('procedural');this.sX=((this.collisionMap.width*0.5)<<0)*this.collisionMap.tilesize;this.sY=((this.collisionMap.height*0.5)<<0)*this.collisionMap.tilesize;}}
if(this.STATE=='game_over'){if(ig.input.released('action')){ig.music.play();this.clearLevel();this.loadLevel(LevelMenuhd);this.pointer.currentRoad={x:0,y:0};this.STATE='hero';return;}}},drawPointer:function(){this.handSheet.drawTile(this.pointer.pos.x,this.pointer.pos.y,this.pointer.state,13,17);},drawHeader:function(string){this.panelLong.draw(this.GUI.centerTop.x-55,this.GUI.centerTop.y-11);this.fontWhite.draw(string,this.GUI.centerTop.x,this.GUI.centerTop.y-5,ig.Font.ALIGN.CENTER);},drawButton:function(options){if(options.small){this.buttonSmallSheet.draw(options.x,options.y);this.fontWhite.draw(options.title,options.x+19,options.y+5,ig.Font.ALIGN.CENTER);}else{this.buttonSheet.draw(options.x,options.y);this.fontWhite.draw(options.title,options.x+35,options.y+5,ig.Font.ALIGN.CENTER);}},draw:function(){this.parent();if(this.STATE=='intro'){this.logoBigSheet.draw(this.GUI.centerMiddle.x-89,this.GUI.centerMiddle.y+6);if(this.timer.delta().toFixed(0)%2!=0){this.fontBlack.draw('PRESS ENTER',this.GUI.centerBottom.x,this.GUI.centerBottom.y-48,ig.Font.ALIGN.CENTER);}
this.fontBlack.draw('Game design & code: P1X Games',this.GUI.centerBottom.x,this.GUI.centerBottom.y-24,ig.Font.ALIGN.CENTER);this.fontBlack.draw('(c) 2014',this.GUI.centerBottom.x,this.GUI.centerBottom.y-14,ig.Font.ALIGN.CENTER);}
if(this.STATE=='quest'){this.drawHeader('\"THE QUEST\"');this.bookSheet.draw(this.GUI.centerMiddle.x-103,this.GUI.centerMiddle.y-24);var msg='many';if(this.scoresFromGameJolt){if(this.scoresFromGameJolt.response&&this.scoresFromGameJolt.response.success=="true"){if(this.scoresFromGameJolt.response.scores.length>1){msg=this.scoresFromGameJolt.response.scores.length;}}}
this.fontWhite.draw('You are Sir Robin\nknown as the Brave.\nYou have to protect\nthe Holy Grail from\nthe hordes of evil\nbeasts.\n\nThere were '+msg+'\nheroes before You.\nAnd none of them\nhave come back\nfrom the dungeons.',this.GUI.centerMiddle.x-90,this.GUI.centerMiddle.y-10,ig.Font.ALIGN.LEFT);this.fontWhite.draw('You are our last\nand only hope.\n\nWe\'re giving You\n'+this.stats.gold+' gold to spend\nfor equipement.\n\nChose Your stats\nwisely and fight\nto the end!',this.GUI.centerMiddle.x+12,this.GUI.centerMiddle.y-10,ig.Font.ALIGN.LEFT);this.buttonSheet.draw(this.GUI.centerMiddle.x+16,this.GUI.centerMiddle.y+86);this.fontWhite.draw('Next',this.GUI.centerMiddle.x+50,this.GUI.centerMiddle.y+91,ig.Font.ALIGN.CENTER);this.drawPointer();}
if(this.STATE=='help'){this.drawHeader('HOW TO PLAY');this.bookSheet.draw(this.GUI.centerMiddle.x-103,this.GUI.centerMiddle.y-24);this.fontWhite.draw('Protect Grails from\nbeing destroyed by\nenemies.\n\nYou gain new stats\npoints for each\nsaved grail.\n\nCollect gold to buy\nbetter gear and\npotions.',this.GUI.centerMiddle.x-90,this.GUI.centerMiddle.y-10,ig.Font.ALIGN.LEFT);this.fontWhite.draw('Keyboard setup.\n\nArrows to move\nX to attack\nS to block\nENTER to use potions',this.GUI.centerMiddle.x+12,this.GUI.centerMiddle.y-10,ig.Font.ALIGN.LEFT);this.buttonSheet.draw(this.GUI.centerMiddle.x+16,this.GUI.centerMiddle.y+86);this.fontWhite.draw('Next',this.GUI.centerMiddle.x+50,this.GUI.centerMiddle.y+91,ig.Font.ALIGN.CENTER);this.drawPointer();}
if(this.STATE=='hero'){this.drawHeader('CHARACTER GENERATION');var string='points';if(this.stats.points==1)string='point';this.fontWhite.draw('You have '+this.stats.points+' '+string+'.',this.GUI.centerTop.x,this.GUI.centerTop.y+16,ig.Font.ALIGN.CENTER)
this.fontWhite.draw('Spend them on stats below or use auto option.',this.GUI.centerTop.x,this.GUI.centerTop.y+26,ig.Font.ALIGN.CENTER)
this.panelStats.draw(this.GUI.stats.x-71,this.GUI.stats.y+1);var sprite;for(var i=0;i<this.stats.maxStats;i++){sprite=2;if(this.stats.maxHealth>i)sprite=1;if(this.stats.health>i)sprite=0;this.guiIconsSheet.drawTile(this.GUI.stats.x-60+(i*8),this.GUI.stats.y+10,sprite,8);sprite=4;if(this.stats.attack>i)sprite=3;this.guiIconsSheet.drawTile(this.GUI.stats.x-60+(i*8),this.GUI.stats.y+20,sprite,8);sprite=6;if(this.stats.defence>i)sprite=5;this.guiIconsSheet.drawTile(this.GUI.stats.x-60+(i*8),this.GUI.stats.y+30,sprite,8);};sprite=this.stats.points>0?7:9;if(this.stats.health==this.stats.maxStats)sprite=9;this.guiIconsSheet.drawTile(this.GUI.stats.x-46+(this.stats.maxStats*8),this.GUI.stats.y+10,sprite,8);sprite=this.stats.points>0?7:9;if(this.stats.attack==this.stats.maxStats)sprite=9;this.guiIconsSheet.drawTile(this.GUI.stats.x-46+(this.stats.maxStats*8),this.GUI.stats.y+20,sprite,8);sprite=this.stats.points>0?7:9;if(this.stats.defence==this.stats.maxStats)sprite=9;this.guiIconsSheet.drawTile(this.GUI.stats.x-46+(this.stats.maxStats*8),this.GUI.stats.y+30,sprite,8);sprite=this.stats.health>1?8:9;this.guiIconsSheet.drawTile(this.GUI.stats.x-56+(this.stats.maxStats*8),this.GUI.stats.y+10,sprite,8);sprite=this.stats.attack>1?8:9;this.guiIconsSheet.drawTile(this.GUI.stats.x-56+(this.stats.maxStats*8),this.GUI.stats.y+20,sprite,8);sprite=this.stats.defence>1?8:9;this.guiIconsSheet.drawTile(this.GUI.stats.x-56+(this.stats.maxStats*8),this.GUI.stats.y+30,sprite,8);var string=this.stats.health>1?'hits points':'hit point';this.fontWhite.draw('Your hero can survive '+this.stats.health+' '+string+' from enemies.\n'+'Have +'+this.stats.attack+' to max attack and '+(10+(2*this.stats.attack))+'% of critical hit.\n'+'Defence protection will last '+(ig.game.stats.defence*0.5).toFixed(1)+' sec. and recharge after '+(ig.game.defence.charge+(ig.game.stats.defence*0.5)).toFixed(1)+' sec.',this.GUI.centerBottom.x,this.GUI.centerBottom.y-60,ig.Font.ALIGN.CENTER);this.buttonSheet.draw(this.GUI.centerBottom.x-66,this.GUI.centerBottom.y-17);this.fontWhite.draw('Auto stats',this.GUI.centerBottom.x-32,this.GUI.centerBottom.y-12,ig.Font.ALIGN.CENTER);this.buttonSheet.draw(this.GUI.centerBottom.x+4,this.GUI.centerBottom.y-17);this.fontWhite.draw('Next step',this.GUI.centerBottom.x+38,this.GUI.centerBottom.y-12,ig.Font.ALIGN.CENTER);this.drawPointer();}
if(this.STATE=='shop'){this.drawHeader('WELCOME TO THE SHOP');this.fontBlack.draw('Attack:',this.GUI.shop.x-132,this.GUI.shop.y+42,ig.Font.ALIGN.LEFT)
this.fontBlack.draw('Charge:',this.GUI.shop.x-132,this.GUI.shop.y+52,ig.Font.ALIGN.LEFT)
this.fontBlack.draw('Price:',this.GUI.shop.x-132,this.GUI.shop.y+62,ig.Font.ALIGN.LEFT)
var title,price,string;for(var i=0;i<4;i++){this.swordSheet.drawTile(this.GUI.shop.x-80+(60*i),this.GUI.shop.y,i,15,28);this.fontBlack.draw(this.swords[i].name,this.GUI.shop.x-72+(60*i),this.GUI.shop.y+32,ig.Font.ALIGN.CENTER);this.fontWhite.draw(this.swords[i].attack.min+' - '+this.swords[i].attack.max,this.GUI.shop.x-72+(60*i),this.GUI.shop.y+42,ig.Font.ALIGN.CENTER);this.fontWhite.draw(this.swords[i].charge.toFixed(1)+' sec.',this.GUI.shop.x-72+(60*i),this.GUI.shop.y+52,ig.Font.ALIGN.CENTER);price=this.swords[i].owned?'-':this.swords[i].price+'g';this.fontBlack.draw(price,this.GUI.shop.x-72+(60*i),this.GUI.shop.y+62,ig.Font.ALIGN.CENTER);if(this.swords[i].active){this.fontWhite.draw('SELECTED',this.GUI.shop.x-72+(60*i),this.GUI.shop.y+78,ig.Font.ALIGN.CENTER);}else{if(this.swords[i].owned){title='USE';this.drawButton({title:title,x:this.GUI.shop.x-92+(60*i),y:this.GUI.shop.y+72,small:true});}else{if(this.swords[i].price<=this.stats.gold){title='BUY';this.drawButton({title:title,x:this.GUI.shop.x-92+(60*i),y:this.GUI.shop.y+72,small:true});}else{title='need gold';this.fontWhite.draw(title,this.GUI.shop.x-72+(60*i),this.GUI.shop.y+78,ig.Font.ALIGN.CENTER);}}}}
this.potionSheet.draw(this.GUI.shop.x-52,this.GUI.shop.y+100);this.fontBlack.draw(this.potions.price+'g',this.GUI.shop.x-32,this.GUI.shop.y+106,ig.Font.ALIGN.LEFT);if(this.potions.price<=this.stats.gold){this.drawButton({title:'BUY 4x POTION',x:this.GUI.shop.x-10,y:this.GUI.shop.y+100});}else{this.fontWhite.draw('need gold',this.GUI.shop.x+14,this.GUI.shop.y+106,ig.Font.ALIGN.CENTER);}
this.chestSheet.draw(this.GUI.centerBottom.x-120,this.GUI.centerBottom.y-18);string=(this.potions.quantity==1)?'potion':'potions';this.fontBlack.draw('You have '+this.stats.gold+' gold and '+this.potions.quantity+' '+string+'.',this.GUI.centerBottom.x-96,this.GUI.centerBottom.y-12,ig.Font.ALIGN.LEFT);this.drawButton({title:'Next step',x:this.GUI.centerBottom.x+52,y:this.GUI.centerBottom.y-18});this.drawPointer();}
if(this.STATE=='map'){this.drawHeader('CHOOSE LOCATION');this.mapSheet.draw(this.GUI.map.x-81,this.GUI.map.y-24);var value=this.pointer.road[this.STATE][this.pointer.currentRoad.y][this.pointer.currentRoad.x].value;if(this.quest.levels[value].open){this.fontBlack.draw('\"'+this.quest.levels[value].title+'\"\nWaves: '+this.quest.levels[value].waves.length,this.GUI.map.x,this.GUI.map.y+74,ig.Font.ALIGN.CENTER)}else{this.fontBlack.draw('Complete other maps to unlock this location!',this.GUI.map.x,this.GUI.map.y+74,ig.Font.ALIGN.CENTER)}
for(var i=0;i<this.pointer.road[this.STATE][0].length;i++){var flag=this.pointer.road[this.STATE][0][i];if(this.quest.levels[i].open){this.flagSheet.draw(flag.x+1,flag.y-7);}};this.drawPointer();}
if(this.STATE=='game'){var robin=this.getEntityByName('robin'),sprite,gold;this.panelLong.draw(this.GUI.centerTop.x-55,this.GUI.centerTop.y-11);this.fontWhite.draw('WAVE: '+this.wave,this.GUI.centerTop.x-44,this.GUI.centerTop.y-5,ig.Font.ALIGN.LEFT);if(this.wave<this.quest.levels[this.quest.currentLevel].waves.length){this.fontWhite.draw('NEXT: '+-(this.waveTimer.delta()<<0)+' sec.',this.GUI.centerTop.x,this.GUI.centerTop.y-5,ig.Font.ALIGN.LEFT);}else{this.fontWhite.draw('LAST WAVE!',this.GUI.centerTop.x,this.GUI.centerTop.y-5,ig.Font.ALIGN.LEFT);}
this.panelShort.draw(this.GUI.centerTop.x-110,this.GUI.centerTop.y-11);this.panelShort.draw(this.GUI.centerTop.x+64,this.GUI.centerTop.y-11);this.guiIconsSheet.drawTile(this.GUI.centerTop.x-100,this.GUI.centerTop.y-6,10,8);this.guiIconsSheet.drawTile(this.GUI.centerTop.x+72,this.GUI.centerTop.y-6,11,8);this.fontWhite.draw(this.potions.quantity,this.GUI.centerTop.x-88,this.GUI.centerTop.y-5,ig.Font.ALIGN.LEFT);gold=robin?this.stats.gold+robin.gold:this.stats.gold;this.fontWhite.draw(gold,this.GUI.centerTop.x+86,this.GUI.centerTop.y-5,ig.Font.ALIGN.LEFT);this.panelLong.draw(this.GUI.centerBottom.x-55,this.GUI.centerBottom.y-7);this.panelShort.draw(this.GUI.centerBottom.x-110,this.GUI.centerBottom.y-7);this.panelShort.draw(this.GUI.centerBottom.x+64,this.GUI.centerBottom.y-7);if(robin){for(var i=0;i<this.stats.maxStats;i++){sprite=2;if(robin.maxHealth>i)sprite=1;if(robin.health>i)sprite=0;this.guiIconsSheet.drawTile(this.GUI.centerBottom.x-47+(i*8),this.GUI.centerBottom.y-2,sprite,8);}}else{this.fontWhite.draw('RESPAWN IN.. '+-(this.respawnTimer.delta().toFixed(1)),this.GUI.centerMiddle.x,this.GUI.centerMiddle.y+28,ig.Font.ALIGN.CENTER);}
for(var i=0;i<4;i++){sprite=4;var p=this.swords[this.activeSword].chargePercentage;if((100-p)>i*20||p<0)sprite=3;this.guiIconsSheet.drawTile(this.GUI.centerBottom.x-104+(i*8),this.GUI.centerBottom.y-2,sprite,8);}
for(var i=0;i<4;i++){sprite=6;var p=this.defence.chargePercentage;if((100-p)>i*20||p<0)sprite=5;this.guiIconsSheet.drawTile(this.GUI.centerBottom.x+72+(i*8),this.GUI.centerBottom.y-2,sprite,8);}}
if(this.STATE=='game_over'){this.gameOverSheet.draw(this.GUI.centerMiddle.x-43,this.GUI.centerMiddle.y-34);this.fontWhite.draw('YOU SCORE '+this.lastScore+'!',this.GUI.centerMiddle.x,this.GUI.centerMiddle.y+40,ig.Font.ALIGN.CENTER);}
if(this.debug)this.drawDebug();if(this.buttons){this.buttons.draw();}}});function toggleFullScreen(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen();}else if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen();}else if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen();}else if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);}}else{if(document.exitFullscreen){document.exitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}}}
GameLoader=ig.Loader.extend({draw:function(){var w=ig.system.realWidth,h=ig.system.realHeight;ig.system.context.fillStyle='#493c2b';ig.system.context.fillRect(0,0,w,h);var logo=new Image(),image=new Image();image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAHCAYAAADAp4fuAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkZGM0Q3MUVGN0RBQTExRTNCQURFQTIxRURERjE4OTJFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkZGM0Q3MUYwN0RBQTExRTNCQURFQTIxRURERjE4OTJFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTJDRkRDNDY3REE5MTFFM0JBREVBMjFFRERGMTg5MkUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RkYzRDcxRUU3REFBMTFFM0JBREVBMjFFRERGMTg5MkUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4png02AAAAVklEQVR42mL8//8/Awi86TICMRhFys4xMIIEQQI8kVYMX5YfA8kzMsEEjrucYADRQPCfCSQDUmG5xwKhkgECGGECIIIJZDBMAsZgkVE3/o/EBwOAAAMA3Pkhi6MK5N8AAAAASUVORK5CYII=";logo.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAUCAYAAAC9BQwsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkUyQ0ZEQzQ0N0RBOTExRTNCQURFQTIxRURERjE4OTJFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkUyQ0ZEQzQ1N0RBOTExRTNCQURFQTIxRURERjE4OTJFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTJDRkRDNDI3REE5MTFFM0JBREVBMjFFRERGMTg5MkUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RTJDRkRDNDM3REE5MTFFM0JBREVBMjFFRERGMTg5MkUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7Tx6srAAAAvklEQVR42mL8//8/Awj8eJwDZhx3OQHmW+6xYEDm6yb/Y4ACRhDBxEAmYNynZgy26Znde6I0SB0SZKDIRhaY25/dJk4DTD35fvwPDdb96iYoJl6ey4SVDwttym2EAWB84tXwZfkxCkMVlhKAAMVmDtkpKC6A2UR5ykHzIsPSVGUUAXdVfhSbYIB6NsLAmy4jsIRI2TlGKJ+BOjZKqxmhWHlnjyV6KIKBwVxGBur6UUbd+D8xGp7cPEtZPAIEGAA8eE2/CXAmPgAAAABJRU5ErkJggg==";var percentage=(this.status*100).round();ig.system.context.drawImage(logo,(ig.system.realWidth*0.5)-7,(ig.system.realHeight*0.5)-50);if(percentage>40){ig.system.context.drawImage(image,(ig.system.realWidth*0.5)-28,ig.system.realHeight*0.5);}
if(percentage>60){ig.system.context.drawImage(image,(ig.system.realWidth*0.5)-12,ig.system.realHeight*0.5);}
if(percentage>80){ig.system.context.drawImage(image,(ig.system.realWidth*0.5)+4,ig.system.realHeight*0.5);}
if(percentage>90){ig.system.context.drawImage(image,(ig.system.realWidth*0.5)+20,ig.system.realHeight*0.5);}}});var w=320,h=180,z=3,fps=24;ig.Sound.channels=16;var c=document.createElement('canvas');c.id='canvas';document.body.appendChild(c);ig.main('#canvas',MyGame,fps,w,h,z,GameLoader);});